import{E as J,j as e,b as R,r as t,Y as K,Z as Y,D as Z,_ as V,T as g,G as N,k as X,C as ee,$ as ae,l as p,m as P,d as se,Q as te,B as T,a1 as U,F as ne,I as ie,y as le,M as k,aI as oe,aJ as ce,aK as re,aL as A,aM as s,aN as de,ab as he,aQ as me,i as xe,a3 as je}from"./index-DU5MK_Av.js";import{F as ge}from"./FormGroup-BkU94RyC.js";const pe=J(e.jsx("path",{d:"M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"})),be=({open:y,onClose:d,user:i,onSave:b})=>{const{enqueueSnackbar:h}=R(),[r,m]=t.useState(i.permissions||{}),u=n=>{m(S=>({...S,[n]:!S[n]}))},x=async()=>{console.log(r,"<======permissions to submit");try{await P.patch(`/user/updatePersmission/${i.id}`,{permissions:r}),h("Permissions updated successfully!",{variant:"success"}),b(),d()}catch(n){console.log(n),h("Failed to update permissions",{variant:"error"})}};return e.jsxs(K,{open:y,onClose:d,fullWidth:!0,maxWidth:"sm",children:[e.jsx(Y,{children:"Change Permissions"}),e.jsx(Z,{}),e.jsxs(V,{children:[e.jsxs(g,{variant:"h3",gutterBottom:!0,children:[i==null?void 0:i.firstName," ",i==null?void 0:i.lastName]}),e.jsx(ge,{children:e.jsxs(N,{container:!0,justifyContent:"center",alignContent:"center",alignItems:"center",spacing:2,children:[Object.keys(r).map(n=>e.jsx(N,{item:!0,xs:6,minWidth:200,children:e.jsx(X,{control:e.jsx(ee,{checked:r[n],onChange:()=>u(n)}),label:n})},n)),e.jsx(N,{item:!0,xs:6,minWidth:200},"yolo")]})})]}),e.jsxs(ae,{children:[e.jsx(p,{onClick:d,children:"Cancel"}),e.jsx(p,{variant:"contained",onClick:x,children:"Save"})]})]})},Ce=()=>{const[y,d]=t.useState([]),[i,b]=t.useState(!0),[h,r]=t.useState(null),[m,u]=t.useState(1),[x]=t.useState(10),[n,S]=t.useState(0),[B,L]=t.useState(""),[F,O]=t.useState(""),[f,W]=t.useState({email:"",name:""}),[v,$]=t.useState("createdAt:desc"),[G,I]=t.useState(!1),[E,q]=t.useState(null),[Q,w]=t.useState(!1),{enqueueSnackbar:M}=R(),z=se(a=>a.auth.token),_=()=>{W({email:B,name:F}),u(1)};t.useEffect(()=>{(async()=>{var l,o,j,c;b(!0);try{const C={page:m,limit:x,email:f.email||void 0,firstName:f.name||void 0,sortBy:v||void 0},D=await P.get("/user",{params:C,headers:{Authorization:z}});d(((l=D.data.data)==null?void 0:l.results)||[]),S(((o=D.data.data)==null?void 0:o.totalResults)||0)}catch(C){r(((c=(j=C.response)==null?void 0:j.data)==null?void 0:c.message)||C.message)}finally{b(!1)}})()},[z,m,x,f,v,G]);const H=async(a,l)=>{var o,j;try{await P.patch(`/user/${a}`,{status:l},{headers:{Authorization:z}}),I(c=>!c),M(`User ${l==="enabled"?"enabled":"disabled"} successfully!`,{variant:"success"})}catch(c){M(((j=(o=c.response)==null?void 0:o.data)==null?void 0:j.message)||c.message||"Failed to update user status",{variant:"error"})}};return e.jsxs(te,{children:[e.jsx(g,{variant:"h2",mb:2,children:"User Control Panel"}),e.jsxs(T,{mb:2,display:"flex",alignItems:"center",gap:2,children:[e.jsx(U,{label:"Search by Email",size:"small",value:B,onChange:a=>L(a.target.value)}),e.jsx(U,{label:"Search by Name",size:"small",value:F,onChange:a=>O(a.target.value)}),e.jsxs(ne,{size:"small",sx:{minWidth:150},children:[e.jsx(ie,{children:"Sort By"}),e.jsxs(le,{value:v,label:"Sort By",onChange:a=>$(a.target.value+":asc"),children:[e.jsx(k,{value:"createdAt:desc",children:"None"}),e.jsx(k,{value:"firstName:asc",children:"Name"}),e.jsx(k,{value:"status:asc",children:"Status"})]})]}),e.jsx(p,{variant:"contained",color:"primary",onClick:_,children:"Search"})]}),i?e.jsx(g,{children:"Loading users..."}):h?e.jsx(g,{color:"error",children:h}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{children:e.jsxs(ce,{size:"small",children:[e.jsx(re,{children:e.jsxs(A,{children:[e.jsx(s,{children:"Name"}),e.jsx(s,{children:"Email"}),e.jsx(s,{children:"Designation"}),e.jsx(s,{children:"Organization"}),e.jsx(s,{children:"Role"}),e.jsx(s,{children:"Type"}),e.jsx(s,{children:"Status"}),e.jsx(s,{align:"center",children:"Action"})]})}),e.jsx(de,{children:y.map(a=>e.jsxs(A,{children:[e.jsxs(s,{children:[a==null?void 0:a.firstName," ",a==null?void 0:a.lastName]}),e.jsx(s,{children:a==null?void 0:a.email}),e.jsx(s,{children:a==null?void 0:a.designation}),e.jsx(s,{children:a==null?void 0:a.organization}),e.jsx(s,{children:a==null?void 0:a.role}),e.jsx(s,{children:a==null?void 0:a.type}),e.jsx(s,{children:e.jsx(he,{label:a.status,color:a.status==="enabled"?"success":"warning",size:"small"})}),e.jsx(s,{align:"center",justifyContent:"center",children:e.jsxs(T,{gap:1,display:"flex",justifyContent:"center",children:[e.jsx(me,{title:e.jsx(T,{children:Object.entries(a.permissions||{}).map(([l,o])=>e.jsxs(g,{variant:"caption",display:"block",children:[l,": ",o?"✅":"❌"]},l))}),arrow:!0,componentsProps:{tooltip:{sx:{bgcolor:"white",color:"black",boxShadow:1,borderRadius:1,fontSize:"0.75rem"}},arrow:{sx:{color:"white"}}},children:e.jsx(xe,{size:"small",color:"primary",children:e.jsx(pe,{})})}),e.jsx(p,{size:"small",variant:"outlined",onClick:()=>{q(a),w(!0)},children:"Change"}),e.jsx(p,{variant:"contained",color:a.status==="enabled"?"error":"success",size:"small",onClick:()=>H(a.id,a.status!=="enabled"?"enabled":"disabled"),children:a.status==="enabled"?"Disable":"Enable"})]})})]},a.id))})]})}),e.jsx(je,{count:Math.ceil(n/x),page:m,onChange:(a,l)=>u(l),color:"primary",sx:{mt:2,display:"flex",justifyContent:"center"}})]}),E&&e.jsx(be,{open:Q,onClose:()=>w(!1),user:E,onSave:()=>I(a=>!a)})]})};export{Ce as default};
