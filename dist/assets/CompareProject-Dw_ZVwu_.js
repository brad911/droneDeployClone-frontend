import{ak as W,r,d as G,j as s,Q as P,B as m,T as $,aA as z,aB as J,aC as Z,aF as k,F as y,y as v,M as b,m as A}from"./index-1owJ3han.js";import{s as L}from"./index-CY-m0sgz.js";import{m as B}from"./mapbox-gl-CYDdXuRH.js";var j,M;function N(){if(M)return j;M=1;function o(e,t){t.jumpTo({center:e.getCenter(),zoom:e.getZoom(),bearing:e.getBearing(),pitch:e.getPitch()})}function i(e,t){a();function a(){e.on("move",c),t.on("move",p)}function u(){e.off("move",c),t.off("move",p)}function c(){u(),o(e,t),a()}function p(){u(),o(t,e),a()}}return j=i,j}var Y=N();const D=W(Y);B.accessToken="pk.eyJ1IjoiaGlyYWtyYWoiLCJhIjoiY21icXd5eHRnMDNtaTJxczcxd2RmbTZwOCJ9.P6kpsuLMDdeK2DIMJZMrmw";const S=({workDay:o,onMapReady:i})=>{const e=r.useRef(null);return r.useEffect(()=>{if(!e.current||!(o!=null&&o.tileBaseUrl))return;const t=new B.Map({container:e.current,style:"mapbox://styles/mapbox/satellite-v9",center:[(o.tileBounds.west+o.tileBounds.east)/2,(o.tileBounds.south+o.tileBounds.north)/2],zoom:o.tileZoomMin??15});return t.on("load",()=>{t.addSource("ortho-source",{type:"raster",tiles:[`${o.tileBaseUrl}/{z}/{x}/{y}.png`],tileSize:256}),t.addLayer({id:"ortho-layer",type:"raster",source:"ortho-source"}),t.scrollZoom.enable(),t.dragPan.enable(),t.dragRotate.enable(),t.keyboard.enable(),i&&i(t)}),()=>t.remove()},[o,i]),s.jsx(m,{ref:e,sx:{width:"100%",height:"100%"}})};function q(){const[o,i]=r.useState([]),[e,t]=r.useState(null),[a,u]=r.useState(null),[c,p]=r.useState(null),[x,C]=r.useState(null),{id:g,name:I}=G(n=>n.project);r.useEffect(()=>{(async()=>{try{const f=(await A.get(`/work-day?projectId=${g}&limit=1000`)).data.data.results.filter(d=>d.tileBaseUrl).map(d=>{const h=new Date(d.name);if(!isNaN(h.getTime())){const R=String(h.getDate()).padStart(2,"0"),E=String(h.getMonth()+1).padStart(2,"0"),F=h.getFullYear();return{...d,name:`${R}-${E}-${F}`}}return d});i(f),f.length>=2&&(t(f[0]),u(f[1]))}catch(l){console.error("Failed to fetch workdays",l)}})()},[g]),r.useEffect(()=>{if(c&&x){const n=D(c,x);return()=>n&&n()}},[c,x]);const T=[{title:"Projects",to:"/project",icon:J},{title:I,to:`/project/${g}/View`,icon:Z},{title:"Compare View",icon:k}];return s.jsxs(P,{children:[s.jsx(m,{sx:{justifyContent:"space-between",alignItems:"center"},children:s.jsx($,{variant:"h1",gutterBottom:!0,children:"Compare View"})}),s.jsx(m,{justifyContent:"left",children:s.jsx(z,{links:T,card:!0,custom:!0,rightAlign:!1})}),s.jsxs(m,{display:"flex",gap:2,mb:3,children:[s.jsx(y,{fullWidth:!0,children:s.jsx(v,{value:(e==null?void 0:e.id)||"",onChange:n=>t(o.find(l=>l.id===n.target.value)),children:o.map(n=>s.jsx(b,{value:n.id,children:n.name},n.id))})}),s.jsx(y,{fullWidth:!0,children:s.jsx(v,{value:(a==null?void 0:a.id)||"",onChange:n=>u(o.find(l=>l.id===n.target.value)),children:o.map(n=>s.jsx(b,{value:n.id,children:n.name},n.id))})})]}),s.jsx(m,{mb:5,borderRadius:2,overflow:"hidden",sx:{height:500},children:e&&a&&s.jsx(L,{onlyHandleDraggable:!0,itemOne:s.jsx(S,{workDay:e,onMapReady:p}),itemTwo:s.jsx(S,{workDay:a,onMapReady:C}),style:{height:"100%"}})})]})}export{q as default};
