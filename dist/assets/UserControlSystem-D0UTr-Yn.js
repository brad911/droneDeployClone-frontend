import{E as Y,j as e,b as R,r as t,$ as J,a0 as K,D as V,a1 as X,T as j,G as k,k as Z,C as ee,a2 as se,l as g,m as P,d as ae,Q as te,B as T,Y as U,F as ne,I as ie,y as re,M as N,bg as le,bh as oe,bi as ce,bj as A,bb as a,bk as de,ab as he,aI as me,i as xe,_ as ue}from"./index-DhShuEpi.js";import{F as je}from"./FormGroup-BFQHmAdr.js";const ge=Y(e.jsx("path",{d:"M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"})),be=({open:y,onClose:d,user:o,onSave:b})=>{const{enqueueSnackbar:h}=R(),[c,m]=t.useState(o.permissions||{}),p=n=>{m(S=>({...S,[n]:!S[n]}))},x=async()=>{console.log(c,"<======permissions to submit");try{await P.patch(`/user/updatePersmission/${o.id}`,{permissions:c}),h("Permissions updated successfully!",{variant:"success"}),b(),d()}catch(n){console.log(n),h("Failed to update permissions",{variant:"error"})}};return e.jsxs(J,{open:y,onClose:d,fullWidth:!0,maxWidth:"sm",children:[e.jsx(K,{children:"Change Permissions"}),e.jsx(V,{}),e.jsxs(X,{children:[e.jsxs(j,{variant:"h3",gutterBottom:!0,children:[o.firstName," ",o.lastName]}),e.jsx(je,{children:e.jsxs(k,{container:!0,justifyContent:"center",alignContent:"center",alignItems:"center",spacing:2,children:[Object.keys(c).map(n=>e.jsx(k,{item:!0,xs:6,minWidth:200,children:e.jsx(Z,{control:e.jsx(ee,{checked:c[n],onChange:()=>p(n)}),label:n})},n)),e.jsx(k,{item:!0,xs:6,minWidth:200},"yolo")]})})]}),e.jsxs(se,{children:[e.jsx(g,{onClick:d,children:"Cancel"}),e.jsx(g,{variant:"contained",onClick:x,children:"Save"})]})]})},Ce=()=>{const[y,d]=t.useState([]),[o,b]=t.useState(!0),[h,c]=t.useState(null),[m,p]=t.useState(1),[x]=t.useState(10),[n,S]=t.useState(0),[B,O]=t.useState(""),[F,W]=t.useState(""),[f,L]=t.useState({email:"",name:""}),[v,$]=t.useState("createdAt:desc"),[G,I]=t.useState(!1),[E,q]=t.useState(null),[_,w]=t.useState(!1),{enqueueSnackbar:D}=R(),z=ae(s=>s.auth.token),H=()=>{L({email:B,name:F}),p(1)};t.useEffect(()=>{(async()=>{var i,r,u,l;b(!0);try{const C={page:m,limit:x,email:f.email||void 0,firstName:f.name||void 0,sortBy:v||void 0},M=await P.get("/user",{params:C,headers:{Authorization:z}});d(((i=M.data.data)==null?void 0:i.results)||[]),S(((r=M.data.data)==null?void 0:r.totalResults)||0)}catch(C){c(((l=(u=C.response)==null?void 0:u.data)==null?void 0:l.message)||C.message)}finally{b(!1)}})()},[z,m,x,f,v,G]);const Q=async(s,i)=>{var r,u;try{await P.patch(`/user/${s}`,{status:i},{headers:{Authorization:z}}),I(l=>!l),D(`User ${i==="enabled"?"enabled":"disabled"} successfully!`,{variant:"success"})}catch(l){D(((u=(r=l.response)==null?void 0:r.data)==null?void 0:u.message)||l.message||"Failed to update user status",{variant:"error"})}};return e.jsxs(te,{children:[e.jsx(j,{variant:"h2",mb:2,children:"User Control Panel"}),e.jsxs(T,{mb:2,display:"flex",alignItems:"center",gap:2,children:[e.jsx(U,{label:"Search by Email",size:"small",value:B,onChange:s=>O(s.target.value)}),e.jsx(U,{label:"Search by Name",size:"small",value:F,onChange:s=>W(s.target.value)}),e.jsxs(ne,{size:"small",sx:{minWidth:150},children:[e.jsx(ie,{children:"Sort By"}),e.jsxs(re,{value:v,label:"Sort By",onChange:s=>$(s.target.value+":asc"),children:[e.jsx(N,{value:"createdAt:desc",children:"None"}),e.jsx(N,{value:"firstName:asc",children:"Name"}),e.jsx(N,{value:"status:asc",children:"Status"})]})]}),e.jsx(g,{variant:"contained",color:"primary",onClick:H,children:"Search"})]}),o?e.jsx(j,{children:"Loading users..."}):h?e.jsx(j,{color:"error",children:h}):e.jsxs(e.Fragment,{children:[e.jsx(le,{children:e.jsxs(oe,{size:"small",children:[e.jsx(ce,{children:e.jsxs(A,{children:[e.jsx(a,{children:"Name"}),e.jsx(a,{children:"Email"}),e.jsx(a,{children:"Designation"}),e.jsx(a,{children:"Organization"}),e.jsx(a,{children:"Role"}),e.jsx(a,{children:"Type"}),e.jsx(a,{children:"Status"}),e.jsx(a,{align:"center",children:"Action"})]})}),e.jsx(de,{children:y.map(s=>e.jsxs(A,{children:[e.jsxs(a,{children:[s.firstName," ",s.lastName]}),e.jsx(a,{children:s.email}),e.jsx(a,{children:s.designation}),e.jsx(a,{children:s.organization}),e.jsx(a,{children:s.role}),e.jsx(a,{children:s.type}),e.jsx(a,{children:e.jsx(he,{label:s.status,color:s.status==="enabled"?"success":"warning",size:"small"})}),e.jsx(a,{align:"center",justifyContent:"center",children:e.jsxs(T,{gap:1,display:"flex",justifyContent:"center",children:[e.jsx(me,{title:e.jsx(T,{children:Object.entries(s.permissions||{}).map(([i,r])=>e.jsxs(j,{variant:"caption",display:"block",children:[i,": ",r?"✅":"❌"]},i))}),arrow:!0,componentsProps:{tooltip:{sx:{bgcolor:"white",color:"black",boxShadow:1,borderRadius:1,fontSize:"0.75rem"}},arrow:{sx:{color:"white"}}},children:e.jsx(xe,{size:"small",color:"primary",children:e.jsx(ge,{})})}),e.jsx(g,{size:"small",variant:"outlined",onClick:()=>{q(s),w(!0)},children:"Change"}),e.jsx(g,{variant:"contained",color:s.status==="enabled"?"error":"success",size:"small",onClick:()=>Q(s.id,s.status!=="enabled"?"enabled":"disabled"),children:s.status==="enabled"?"Disable":"Enable"})]})})]},s.id))})]})}),e.jsx(ue,{count:Math.ceil(n/x),page:m,onChange:(s,i)=>p(i),color:"primary",sx:{mt:2,display:"flex",justifyContent:"center"}})]}),E&&e.jsx(be,{open:_,onClose:()=>w(!1),user:E,onSave:()=>I(s=>!s)})]})};export{Ce as default};
