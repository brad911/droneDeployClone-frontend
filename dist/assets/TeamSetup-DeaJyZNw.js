import{E as F,j as e,u as L,b as D,r as x,d as P,Q as H,B,T as b,aA as q,aB as O,aC as V,bo as W,a5 as _,a1 as E,M as u,l as $,aI as J,aJ as K,aK as Q,aL as T,aM as r,aN as U,y as G,ab as X,i as Y,be as Z,m as y}from"./index-CK-c6caZ.js";const ee=F(e.jsx("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"})),ae=()=>{const l=L(),{enqueueSnackbar:d}=D(),[I,m]=x.useState([]),[j,f]=x.useState(""),[w,S]=x.useState("viewer"),[N,z]=x.useState(!0),[C,p]=x.useState(null),g=P(s=>s.project.id),h=P(s=>s.auth.token);x.useEffect(()=>{if(!g)return;(async()=>{var n,i,o;z(!0);try{const t=await y.get("/project-members/query",{params:{projectId:g},headers:{Authorization:h}});m(((n=t.data.data)==null?void 0:n.results)||[])}catch(t){p(((o=(i=t.response)==null?void 0:i.data)==null?void 0:o.message)||t.message)}finally{z(!1)}})()},[g,h]);const k=async()=>{var n,i,o,t;if(!j)return;let s=j.trim();f("");try{const a=await y.post("/project-members",{projectId:g,email:s,role:w,status:"invited"},{headers:{Authorization:h}});m(c=>[...c,a.data.data]),S("viewer"),d("Team member invited successfully!",{variant:"success"})}catch(a){p(((i=(n=a.response)==null?void 0:n.data)==null?void 0:i.message)||a.message),d(((t=(o=a.response)==null?void 0:o.data)==null?void 0:t.message)||a.message||"Failed to invite member",{variant:"error"})}},A=async(s,n)=>{var i,o,t,a;try{await y.patch(`/project-members/${s}`,{role:n},{headers:{Authorization:h}}),m(c=>c.map(v=>v._id===s||v.id===s?{...v,role:n}:v)),d("Role updated successfully!",{variant:"success"})}catch(c){p(((o=(i=c.response)==null?void 0:i.data)==null?void 0:o.message)||c.message),d(((a=(t=c.response)==null?void 0:t.data)==null?void 0:a.message)||c.message||"Failed to update role",{variant:"error"})}},M=async s=>{var n,i,o,t;try{await y.delete(`/project-members/${s}`,{headers:{Authorization:h}}),m(I.filter(a=>a._id!==s)),d("Team member removed successfully!",{variant:"success"})}catch(a){p(((i=(n=a.response)==null?void 0:n.data)==null?void 0:i.message)||a.message),d(((t=(o=a.response)==null?void 0:o.data)==null?void 0:t.message)||a.message||"Failed to remove member",{variant:"error"})}},R=[{title:"Projects",to:"/project",icon:O},{title:"Project Name",to:"/project/1/View",icon:V},{title:"Project Team",icon:W}];return e.jsxs(H,{children:[e.jsxs(B,{children:[e.jsx(b,{variant:"h1",gutterBottom:!0,children:"Project Team"}),e.jsx(q,{links:R,card:!0,custom:!0,rightAlign:!1})]}),N?e.jsx(b,{variant:"body1",children:"Loading team members..."}):C?e.jsx(b,{color:"error",children:C}):e.jsxs(_,{sx:{p:3,mx:"auto",mt:3,boxShadow:4},children:[e.jsxs(B,{sx:{display:"flex",gap:2,mb:3,alignItems:"center"},children:[e.jsx(E,{label:"Invite by Email",size:"small",value:j,onChange:s=>f(s.target.value),sx:{flex:1}}),e.jsxs(E,{select:!0,label:"Permission",size:"small",value:w,onChange:s=>S(s.target.value),sx:{flex:1,minWidth:120},children:[e.jsx(u,{value:"editor",children:"editor"}),e.jsx(u,{value:"viewer",children:"viewer"})]}),e.jsx($,{variant:"contained",color:"primary",startIcon:e.jsx(ee,{}),onClick:k,disabled:!j,children:"Invite"})]}),e.jsx(J,{children:e.jsxs(K,{size:"small",children:[e.jsx(Q,{children:e.jsxs(T,{sx:{bgcolor:l.palette.primary.light},children:[e.jsx(r,{sx:{color:l.palette.primary.contrastText},children:"Email"}),e.jsx(r,{sx:{color:l.palette.primary.contrastText},children:"Name"}),e.jsx(r,{sx:{color:l.palette.primary.contrastText},children:"Organization"}),e.jsx(r,{sx:{color:l.palette.primary.contrastText},children:"Designation"}),e.jsx(r,{sx:{color:l.palette.primary.contrastText},children:"Permission"}),e.jsx(r,{sx:{color:l.palette.primary.contrastText},children:"Status"}),e.jsx(r,{align:"center",sx:{color:l.palette.primary.contrastText},children:"Action"})]})}),e.jsxs(U,{children:[I.map(s=>{var n,i,o,t;return e.jsxs(T,{children:[e.jsx(r,{children:s.email}),e.jsx(r,{children:s.userId?s.userId.firstName+" "+s.userId.lastName:"Not Registered"}),e.jsx(r,{children:(n=s.userId)!=null&&n.organization?(i=s.userId)==null?void 0:i.organization:"Not Registered"}),e.jsx(r,{children:(o=s.userId)!=null&&o.designation?(t=s.userId)==null?void 0:t.designation:"Not Registered"}),e.jsx(r,{children:e.jsxs(G,{size:"small",value:s.role,onChange:a=>A(s.id,a.target.value),sx:{minWidth:90},disabled:s.role==="owner",children:[e.jsx(u,{value:"editor",children:"editor"}),e.jsx(u,{value:"viewer",children:"viewer"}),s.role==="owner"?e.jsx(u,{value:"owner",children:"owner"}):null]})}),e.jsx(r,{children:e.jsx(X,{label:s.status,color:s.status==="active"?"success":"warning",size:"small"})}),e.jsx(r,{align:"center",children:e.jsx(Y,{color:"error",onClick:()=>M(s.id),children:e.jsx(Z,{})})})]},s.id)}),I.length===0&&e.jsx(T,{children:e.jsx(r,{colSpan:4,align:"center",sx:{color:l.palette.text.disabled},children:"No team members yet."})})]})]})})]})]})};export{ae as default};
