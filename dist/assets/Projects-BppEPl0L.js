import{E as ce,j as e,a as U,c as de,r as o,U as ue,B as I,T as p,V as he,S as T,i as xe,W as pe,M as g,X as me,Y as V,Z as q,_ as R,$ as Y,l as f,a0 as _,a1 as P,n as je,d as ge,G as x,F as fe,I as ve,y as Ce,a2 as De,a3 as Se,m as O,a4 as C}from"./index-nmVS5eNA.js";import{P as ye}from"./Person-D-LrhozS.js";import{C as be,M as we}from"./MoreVert-CbN-QfYC.js";const Pe=ce(e.jsx("path",{d:"M22 16V4c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2m-11-4 2.03 2.71L16 11l4 5H8zM2 6v14c0 1.1.9 2 2 2h14v-2H4V6z"})),Ie="/assets/conture-map-DVTY2EDp.jpg",ke=({project:a,count:r,onDelete:i,onDuplicate:n,onEdit:l})=>{const c=U(),D=de(),[u,h]=o.useState(null),k=!!u,S=t=>{t.stopPropagation(),h(t.currentTarget)},y=t=>{var v;(v=t==null?void 0:t.stopPropagation)==null||v.call(t),h(null)},b=t=>{t.stopPropagation(),h(null),i==null||i(a)},m=t=>{t.stopPropagation(),h(null),n==null||n(a)},M=t=>{t.stopPropagation(),h(null),l==null||l(a)},W=t=>{var B;(B=t==null?void 0:t.stopPropagation)==null||B.call(t),h(null);const v=a._id||a.id;D(me({id:v,name:a.name,location:a.location})),c(`/project/${v}/View`)};return e.jsxs(ue,{elevation:4,sx:{maxHeight:220,position:"relative",width:320,borderRadius:3,overflow:"hidden",cursor:"pointer",transition:"0.3s","&:hover":{boxShadow:6}},onClick:W,children:[e.jsxs(I,{sx:{position:"relative",height:140},children:[e.jsx(be,{component:"img",height:"140",image:Ie,alt:a==null?void 0:a.name,sx:{objectFit:"cover",filter:"brightness(60%)"}}),e.jsx(I,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",px:2},children:e.jsx(p,{variant:"subtitle1",fontWeight:700,color:"white",noWrap:!0,sx:{textShadow:"0px 1px 3px rgba(0,0,0,0.6)"},children:a==null?void 0:a.name})})]}),e.jsx(he,{sx:{pt:1,pb:1},children:e.jsxs(T,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(T,{direction:"row",spacing:1.5,alignItems:"center",flexWrap:"nowrap",children:[e.jsxs(T,{direction:"row",spacing:.5,alignItems:"center",sx:{minWidth:0},children:[e.jsx(Pe,{fontSize:"small"}),e.jsx(p,{variant:"caption",sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:140},children:a==null?void 0:a.location})]}),e.jsxs(T,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(ye,{fontSize:"small"}),e.jsx(p,{variant:"caption",children:r})]}),e.jsx(p,{variant:"caption",fontSize:10,color:"text.secondary",children:a!=null&&a.createdAt?new Date(a.createdAt).toLocaleDateString("en-GB").replace(/\//g,"-"):"Date unknown"})]}),e.jsxs(I,{children:[e.jsx(xe,{size:"small",onClick:S,sx:{color:"text.secondary","&:hover":{backgroundColor:"rgba(0,0,0,0.05)"}},children:e.jsx(we,{fontSize:"small"})}),e.jsxs(pe,{anchorEl:u,open:k,onClose:y,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[e.jsx(g,{onClick:t=>{t.stopPropagation(),W(t)},children:"View"}),e.jsx(g,{onClick:t=>{t.stopPropagation(),M(t)},children:"Edit"}),e.jsx(g,{onClick:t=>{t.stopPropagation(),m(t)},children:"Duplicate"}),e.jsx(g,{onClick:t=>{t.stopPropagation(),b(t)},children:"Delete"})]})]})]})})]})},We=({open:a,deleting:r,selectedProject:i,onClose:n,onConfirm:l})=>e.jsxs(V,{open:a,onClose:()=>!r&&n(),fullWidth:!0,maxWidth:"xs",children:[e.jsx(q,{children:"Delete Project"}),e.jsx(R,{children:e.jsxs(p,{children:["You are about to delete ",e.jsx("strong",{children:i==null?void 0:i.name}),". This action cannot be undone."]})}),e.jsxs(Y,{children:[e.jsx(f,{onClick:n,disabled:r,children:"Cancel"}),e.jsx(f,{color:"error",variant:"contained",onClick:l,disabled:r,startIcon:r?e.jsx(_,{size:18}):null,children:r?"Deleting...":"Delete"})]})]}),Ee=({open:a,duplicating:r,selectedProject:i,onClose:n,onConfirm:l})=>e.jsxs(V,{open:a,onClose:()=>!r&&n(),fullWidth:!0,maxWidth:"xs",children:[e.jsx(q,{children:"Duplicate Project"}),e.jsx(R,{children:e.jsxs(p,{children:["You are about to duplicate ",e.jsx("strong",{children:i==null?void 0:i.name}),". This will create a copy of the project with all related data."]})}),e.jsxs(Y,{children:[e.jsx(f,{onClick:n,disabled:r,children:"Cancel"}),e.jsx(f,{variant:"contained",color:"primary",onClick:l,disabled:r,startIcon:r?e.jsx(_,{size:18}):null,children:r?"Duplicating...":"Duplicate"})]})]}),ze=({open:a,onClose:r,onSave:i,selectedProject:n,saving:l})=>{const[c,D]=o.useState({name:"",location:"",description:"",startDate:"",endDate:""});o.useEffect(()=>{n&&D({name:n.name||"",location:n.location||"",description:n.description||"",startDate:n.startDate?n.startDate.split("T")[0]:"",endDate:n.endDate?n.endDate.split("T")[0]:""})},[n]);const u=k=>{const{name:S,value:y}=k.target;D(b=>({...b,[S]:y}))},h=()=>{i(c)};return e.jsxs(V,{open:a,onClose:()=>!l&&r(),fullWidth:!0,maxWidth:"sm",children:[e.jsx(q,{children:"Edit Project"}),e.jsx(R,{children:e.jsxs(T,{spacing:2,mt:1,children:[e.jsx(P,{label:"Project Name",name:"name",value:c.name,onChange:u,fullWidth:!0,required:!0}),e.jsx(P,{label:"Location",name:"location",value:c.location,onChange:u,fullWidth:!0,required:!0}),e.jsx(P,{label:"Description",name:"description",value:c.description,onChange:u,fullWidth:!0,multiline:!0,minRows:3}),e.jsx(P,{label:"Start Date",name:"startDate",type:"date",value:c.startDate,onChange:u,fullWidth:!0,InputLabelProps:{shrink:!0}}),e.jsx(P,{label:"End Date",name:"endDate",type:"date",value:c.endDate,onChange:u,fullWidth:!0,InputLabelProps:{shrink:!0}})]})}),e.jsxs(Y,{children:[e.jsx(f,{onClick:r,disabled:l,children:"Cancel"}),e.jsx(f,{variant:"contained",onClick:h,disabled:l,startIcon:l?e.jsx(_,{size:18}):null,children:l?"Saving...":"Save"})]})]})};function Oe(){const a=je(),r=U(),i=ge(s=>s.auth),[n,l]=o.useState(""),[c,D]=o.useState("project.createdAt:desc"),[u,h]=o.useState([]),[k,S]=o.useState(!1),[y,b]=o.useState(null),[m,M]=o.useState(1),[W,t]=o.useState(1),v=12,[B,L]=o.useState(!1),[j,E]=o.useState(null),[X,$]=o.useState(!1),[J,N]=o.useState(!1),[K,H]=o.useState(!1),[Q,F]=o.useState(!1),[ee,G]=o.useState(!1),z=async(s="",d="",le=1)=>{var Z;S(!0),b(null);try{const A={email:i.user.email,status:"active",page:le,limit:v};s&&(A.projectName=s),d&&(A.sortBy=d);const w=(Z=(await O.get("/project-members",{params:A,headers:{Authorization:i.token}})).data)==null?void 0:Z.data;h((w==null?void 0:w.results)||[]),t((w==null?void 0:w.totalPages)||1)}catch(A){b(A.message||"Failed to fetch projects")}finally{S(!1)}},te=s=>{E(s),N(!0)},ae=async()=>{if(j){H(!0);try{(await O.post(`/project/duplicate/${j._id}`)).status===200&&(C("Project duplicated successfully",{variant:"success"}),z(n,c,m))}catch(s){console.log(s),C("Error duplicating project",{variant:"error"})}finally{H(!1),N(!1),E(null)}}},ne=s=>{E(s),F(!0)},se=async s=>{G(!0);try{(await O.patch(`/project/${j._id}`,s,{headers:{Authorization:i.token}})).status===200&&(C("Project updated successfully",{variant:"success"}),z(n,c,m))}catch{C("Error updating project",{variant:"error"})}finally{G(!1),F(!1)}};o.useEffect(()=>{z(n,c,m)},[m]);const re=()=>{M(1),z(n,c,1)},ie=async()=>{var s;if(j){$(!0);try{(await O.delete(`/project/${j._id}`,{headers:{Authorization:i.token}})).status===200&&(C("Project deleted successfully",{variant:"success"}),z(n,c,m))}catch(d){console.log("Error deleting project:",d),((s=d==null?void 0:d.response)==null?void 0:s.status)===403?C("You do not have permission to delete this project",{variant:"error"}):C("Error deleting project",{variant:"error"})}finally{$(!1),L(!1),E(null)}}},oe=s=>{E(s),L(!0)};return e.jsxs(I,{p:3,children:[e.jsxs(x,{container:!0,spacing:2,alignItems:"center",justifyContent:"space-between",mb:3,children:[e.jsx(x,{item:!0,xs:12,md:3,children:e.jsx(p,{variant:"h2",fontWeight:600,children:"All Projects"})}),e.jsx(x,{item:!0,xs:12,md:6,children:e.jsxs(x,{container:!0,justifyContent:"center",alignItems:"center",spacing:2,children:[e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(P,{label:"Search by Name",variant:"outlined",size:"small",fullWidth:!0,value:n,onChange:s=>l(s.target.value)})}),e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsxs(fe,{sx:{...a.typography.customSelect2,minWidth:"100px"},fullWidth:!0,children:[e.jsx(ve,{children:"Sort By"}),e.jsxs(Ce,{size:"small",value:c,label:"Sort By",onChange:s=>D(s.target.value),children:[e.jsx(g,{value:"project.name:asc",children:"Project Name (A → Z)"}),e.jsx(g,{value:"project.name:desc",children:"Project Name (Z → A)"}),e.jsx(g,{value:"project.createdAt:desc",children:"Project Date (Newest)"}),e.jsx(g,{value:"project.createdAt:asc",children:"Project Date (Oldest)"})]})]})}),e.jsx(x,{item:!0,xs:12,sm:2,children:e.jsx(f,{variant:"contained",fullWidth:!0,onClick:re,children:"Search"})})]})}),e.jsx(x,{item:!0,xs:12,md:3,textAlign:{xs:"left",md:"right"},children:e.jsx(f,{variant:"contained",onClick:()=>r("/createProject"),startIcon:e.jsx(De,{}),color:"primary",children:"Create New Project"})})]}),k?e.jsx(p,{variant:"body1",children:"Loading projects..."}):y?e.jsx(p,{color:"error",children:y}):u.length===0?e.jsx(I,{mt:6,textAlign:"center",children:e.jsx(p,{variant:"h6",color:"text.secondary",children:"No projects found. Create a project to start working."})}):e.jsxs(e.Fragment,{children:[e.jsx(x,{container:!0,spacing:3,children:u.map((s,d)=>e.jsx(x,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsx(ke,{project:s.project,count:s.memberCount,onDelete:oe,onDuplicate:te,onEdit:ne})},d))}),W>1&&e.jsx(I,{mt:4,display:"flex",justifyContent:"center",children:e.jsx(Se,{count:W,page:m,onChange:(s,d)=>M(d),color:"primary"})})]}),e.jsx(We,{open:B,deleting:X,selectedProject:j,onClose:()=>L(!1),onConfirm:ie}),e.jsx(Ee,{open:J,duplicating:K,selectedProject:j,onClose:()=>N(!1),onConfirm:ae}),e.jsx(ze,{open:Q,onClose:()=>F(!1),onSave:se,selectedProject:j,saving:ee})]})}export{Oe as default};
