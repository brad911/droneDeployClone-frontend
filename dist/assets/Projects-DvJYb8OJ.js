import{E as J,j as e,a as V,c as K,r as h,U as Q,B as b,T as v,V as ee,S as k,i as te,W as ne,M as C,X as se,n as ae,d as re,G as D,Y as ie,F as oe,I as ce,y as le,l as z,Z as ue,_ as de,$ as he,a0 as fe,a1 as me,a2 as xe,a3 as ge,m as Y,a4 as W}from"./index-ilolb5oh.js";import{P as je}from"./Person-CpgQK1ka.js";import{C as De,M as ve}from"./MoreVert-CnmUpezZ.js";import{t as P,c as Se,n as X,g as _,a as Me,e as ye,m as L,b as A}from"./en-US-CRQByS1p.js";import{e as Ce,a as be}from"./endOfMonth-4FTE1eXr.js";const we=J(e.jsx("path",{d:"M22 16V4c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2m-11-4 2.03 2.71L16 11l4 5H8zM2 6v14c0 1.1.9 2 2 2h14v-2H4V6z"}));function O(t,i){const n=+P(t)-+P(i);return n<0?-1:n>0?1:n}function Ie(t){return Se(t,Date.now())}function pe(t,i,n){const[o,s]=X(n==null?void 0:n.in,t,i),l=o.getFullYear()-s.getFullYear(),u=o.getMonth()-s.getMonth();return l*12+u}function Pe(t){return i=>{const o=(t?Math[t]:Math.trunc)(i);return o===0?0:o}}function Te(t,i){return+P(t)-+P(i)}function ke(t,i){const n=P(t,i==null?void 0:i.in);return+Ce(n,i)==+be(n,i)}function ze(t,i,n){const[o,s,l]=X(n==null?void 0:n.in,t,t,i),u=O(s,l),r=Math.abs(pe(s,l));if(r<1)return 0;s.getMonth()===1&&s.getDate()>27&&s.setDate(30),s.setMonth(s.getMonth()-u*r);let g=O(s,l)===-u;ke(o)&&r===1&&O(o,l)===1&&(g=!1);const j=u*(r-+g);return j===0?0:j}function Ae(t,i,n){const o=Te(t,i)/1e3;return Pe(n==null?void 0:n.roundingMethod)(o)}function Oe(t,i,n){const o=Me(),s=(n==null?void 0:n.locale)??o.locale??ye,l=2520,u=O(t,i);if(isNaN(u))throw new RangeError("Invalid time value");const r=Object.assign({},n,{addSuffix:n==null?void 0:n.addSuffix,comparison:u}),[g,j]=X(n==null?void 0:n.in,...u>0?[i,t]:[t,i]),f=Ae(j,g),S=(_(j)-_(g))/1e3,a=Math.round((f-S)/60);let m;if(a<2)return n!=null&&n.includeSeconds?f<5?s.formatDistance("lessThanXSeconds",5,r):f<10?s.formatDistance("lessThanXSeconds",10,r):f<20?s.formatDistance("lessThanXSeconds",20,r):f<40?s.formatDistance("halfAMinute",0,r):f<60?s.formatDistance("lessThanXMinutes",1,r):s.formatDistance("xMinutes",1,r):a===0?s.formatDistance("lessThanXMinutes",1,r):s.formatDistance("xMinutes",a,r);if(a<45)return s.formatDistance("xMinutes",a,r);if(a<90)return s.formatDistance("aboutXHours",1,r);if(a<L){const x=Math.round(a/60);return s.formatDistance("aboutXHours",x,r)}else{if(a<l)return s.formatDistance("xDays",1,r);if(a<A){const x=Math.round(a/L);return s.formatDistance("xDays",x,r)}else if(a<A*2)return m=Math.round(a/A),s.formatDistance("aboutXMonths",m,r)}if(m=ze(j,g),m<12){const x=Math.round(a/A);return s.formatDistance("xMonths",x,r)}else{const x=m%12,M=Math.trunc(m/12);return x<3?s.formatDistance("aboutXYears",M,r):x<9?s.formatDistance("overXYears",M,r):s.formatDistance("almostXYears",M+1,r)}}function Ne(t,i){return Oe(t,Ie(t),i)}const We="/assets/conture-map-DVTY2EDp.jpg",Xe=({project:t,count:i,onDelete:n})=>{const o=V(),s=K(),[l,u]=h.useState(null),r=!!l,g=a=>{a.stopPropagation(),u(a.currentTarget)},j=a=>{a.stopPropagation(),u(null)},f=a=>{a.stopPropagation(),u(null),n&&n(t)},S=()=>{const a=t._id||t.id;s(se({id:a,name:t.name})),o(`/project/${a}/View`)};return e.jsxs(Q,{elevation:4,sx:{maxHeight:220,position:"relative",width:320,borderRadius:3,overflow:"hidden",cursor:"pointer",transition:"0.3s","&:hover":{boxShadow:6}},onClick:S,children:[e.jsxs(b,{sx:{position:"relative",height:140},children:[e.jsx(De,{component:"img",height:"140",image:We,alt:t==null?void 0:t.name,sx:{objectFit:"cover",filter:"brightness(60%)"}}),e.jsx(b,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",px:2},children:e.jsx(v,{variant:"subtitle1",fontWeight:700,color:"white",noWrap:!0,children:t==null?void 0:t.name})})]}),e.jsx(ee,{sx:{pt:1,pb:1},children:e.jsxs(k,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(k,{direction:"row",spacing:1.5,alignItems:"center",flexWrap:"nowrap",children:[e.jsxs(k,{direction:"row",spacing:.5,alignItems:"center",sx:{minWidth:0},children:[e.jsx(we,{fontSize:"small"}),e.jsx(v,{variant:"caption",sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:140},children:t==null?void 0:t.location})]}),e.jsxs(k,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(je,{fontSize:"small"}),e.jsx(v,{variant:"caption",children:i})]}),e.jsx(v,{variant:"caption",fontSize:8,color:"text.secondary",children:t!=null&&t.createdAt?`${Ne(new Date(t==null?void 0:t.createdAt),{addSuffix:!0})}`:"Time unknown"})]}),e.jsxs(b,{children:[e.jsx(te,{size:"small",onClick:g,sx:{color:"text.secondary","&:hover":{backgroundColor:"rgba(0,0,0,0.05)"}},children:e.jsx(ve,{fontSize:"small"})}),e.jsxs(ne,{anchorEl:l,open:r,onClose:j,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[e.jsx(C,{onClick:f,children:"Delete"}),e.jsx(C,{onClick:a=>{a.stopPropagation(),S()},children:"View"})]})]})]})})]})};function Ve(){const t=ae(),i=V(),n=re(c=>c.auth),[o,s]=h.useState(""),[l,u]=h.useState("project.name:asc"),[r,g]=h.useState([]),[j,f]=h.useState(!1),[S,a]=h.useState(null),[m,x]=h.useState(1),[M,H]=h.useState(1),R=12,[$,T]=h.useState(!1),[w,E]=h.useState(null),[I,F]=h.useState(!1),N=async(c="",d="",U=1)=>{var B;f(!0),a(null);try{const p={email:n.user.email,status:"active",page:U,limit:R};c&&(p.projectName=c),d&&(p.sortBy=d);const y=(B=(await Y.get("/project-members",{params:p,headers:{Authorization:n.token}})).data)==null?void 0:B.data;g((y==null?void 0:y.results)||[]),H((y==null?void 0:y.totalPages)||1)}catch(p){a(p.message||"Failed to fetch projects")}finally{f(!1)}};h.useEffect(()=>{N(o,l,m)},[m]);const Z=()=>{x(1),N(o,l,1)},q=async()=>{var c;if(w){F(!0);try{(await Y.delete(`/project/${w._id}`,{headers:{Authorization:n.token}})).status===200&&(W("Project deleted successfully",{variant:"success"}),N(o,l,m))}catch(d){console.log("Error deleting project:",d),((c=d==null?void 0:d.response)==null?void 0:c.status)===403?W("You do not have permission to delete this project",{variant:"error"}):W("Error deleting project",{variant:"error"})}finally{F(!1),T(!1),E(null)}}},G=c=>{E(c),T(!0)};return e.jsxs(b,{p:3,children:[e.jsxs(D,{container:!0,spacing:2,alignItems:"center",justifyContent:"space-between",mb:3,children:[e.jsx(D,{item:!0,xs:12,md:3,children:e.jsx(v,{variant:"h2",fontWeight:600,children:"All Projects"})}),e.jsx(D,{item:!0,xs:12,md:6,children:e.jsxs(D,{container:!0,justifyContent:"center",alignItems:"center",spacing:2,children:[e.jsx(D,{item:!0,xs:12,sm:6,children:e.jsx(ie,{label:"Search by Name",variant:"outlined",size:"small",fullWidth:!0,value:o,onChange:c=>s(c.target.value)})}),e.jsx(D,{item:!0,xs:12,sm:6,children:e.jsxs(oe,{sx:{...t.typography.customSelect2,minWidth:"100px"},fullWidth:!0,children:[e.jsx(ce,{children:"Sort By"}),e.jsxs(le,{size:"small",value:l,label:"Sort By",onChange:c=>u(c.target.value),children:[e.jsx(C,{value:"project.name:asc",children:"Project Name (A → Z)"}),e.jsx(C,{value:"project.name:desc",children:"Project Name (Z → A)"}),e.jsx(C,{value:"project.createdAt:desc",children:"Project Date (Newest)"}),e.jsx(C,{value:"project.createdAt:asc",children:"Project Date (Oldest)"})]})]})}),e.jsx(D,{item:!0,xs:12,sm:2,children:e.jsx(z,{variant:"contained",fullWidth:!0,onClick:Z,children:"Search"})})]})}),e.jsx(D,{item:!0,xs:12,md:3,textAlign:{xs:"left",md:"right"},children:e.jsx(z,{variant:"contained",onClick:()=>i("/createProject"),startIcon:e.jsx(ue,{}),color:"primary",children:"Create New Project"})})]}),j?e.jsx(v,{variant:"body1",children:"Loading projects..."}):S?e.jsx(v,{color:"error",children:S}):r.length===0?e.jsx(b,{mt:6,textAlign:"center",children:e.jsx(v,{variant:"h6",color:"text.secondary",children:"No projects found. Create a project to start working."})}):e.jsxs(e.Fragment,{children:[e.jsx(D,{container:!0,spacing:3,children:r.map((c,d)=>e.jsx(D,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsx(Xe,{project:c.project,count:c.memberCount,onDelete:G})},d))}),M>1&&e.jsx(b,{mt:4,display:"flex",justifyContent:"center",children:e.jsx(de,{count:M,page:m,onChange:(c,d)=>x(d),color:"primary"})})]}),e.jsxs(he,{open:$,onClose:()=>!I&&T(!1),fullWidth:!0,maxWidth:"xs",children:[e.jsx(fe,{children:"Delete Project"}),e.jsx(me,{children:e.jsxs(v,{children:["You are about to delete ",e.jsx("strong",{children:w==null?void 0:w.name}),". This action cannot be undone."]})}),e.jsxs(xe,{children:[e.jsx(z,{onClick:()=>T(!1),disabled:I,children:"Cancel"}),e.jsx(z,{color:"error",variant:"contained",onClick:q,disabled:I,startIcon:I?e.jsx(ge,{size:18}):null,children:I?"Deleting...":"Delete"})]})]})]})}export{Ve as default};
