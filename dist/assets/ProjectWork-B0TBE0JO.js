import{V as Oe,U as Ne,t as we,j as n,r as L,aq as Ue,ar as ce,y as be,Y as Ge,a7 as Ae,Z as We,af as He,as as at,at as _e,au as Ie,av as Le,aw as qe,b as st,d as le,ax as nt,B as X,T as ne,ay as it,h as U,aa as lt,al as Q,M as ze,az as ct,aA as dt,aB as pt,D as ut}from"./index-BtuXuQf8.js";import{m as V}from"./mapbox-gl-CTcOMytr.js";import{M as yt,g as ke}from"./index-CXmFUdfU.js";import{d as ft}from"./dayjs.min-Dy8-L4hT.js";import{u as gt,I as mt}from"./index-thpJSRVm.js";import{T as Ve}from"./TextField-DZVtpTsY.js";import{B as ue,C as Ye,I as ht}from"./InputLabel-DL6JPDLP.js";import{I as Ze}from"./IconButton-CRzXFQNH.js";import{I as vt}from"./IconBuildingCog-CxzYFg-g.js";import{u as xt,f as wt,F as bt}from"./OutlinedInput-BGMNv7B1.js";import{F as he,C as ve}from"./FormControlLabel-BiIjn4fF.js";import{S as Ct}from"./Select-OpV829Oc.js";import{M as St}from"./MenuItem-CLijjBHm.js";import"./FormHelperText-Dp4oNs3X.js";function Mt(e){return Ne("MuiAlert",e)}const Te=Oe("MuiAlert",["root","action","icon","message","filled","colorSuccess","colorInfo","colorWarning","colorError","filledSuccess","filledInfo","filledWarning","filledError","outlined","outlinedSuccess","outlinedInfo","outlinedWarning","outlinedError","standard","standardSuccess","standardInfo","standardWarning","standardError"]),Pt=we(n.jsx("path",{d:"M20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4C12.76,4 13.5,4.11 14.2, 4.31L15.77,2.74C14.61,2.26 13.34,2 12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0, 0 22,12M7.91,10.08L6.5,11.5L11,16L21,6L19.59,4.58L11,13.17L7.91,10.08Z"})),Lt=we(n.jsx("path",{d:"M12 5.99L19.53 19H4.47L12 5.99M12 2L1 21h22L12 2zm1 14h-2v2h2v-2zm0-6h-2v4h2v-4z"})),kt=we(n.jsx("path",{d:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"})),jt=we(n.jsx("path",{d:"M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20, 12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10, 10 0 0,0 12,2M11,17H13V11H11V17Z"})),Ft=we(n.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})),At=e=>{const{variant:o,color:r,severity:t,classes:s}=e,i={root:["root",`color${Ae(r||t)}`,`${o}${Ae(r||t)}`,`${o}`],icon:["icon"],message:["message"],action:["action"]};return We(i,Mt,s)},Et=be(He,{name:"MuiAlert",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:r}=e;return[o.root,o[r.variant],o[`${r.variant}${Ae(r.color||r.severity)}`]]}})(at(({theme:e})=>{const o=e.palette.mode==="light"?_e:Ie,r=e.palette.mode==="light"?Ie:_e;return{...e.typography.body2,backgroundColor:"transparent",display:"flex",padding:"6px 16px",variants:[...Object.entries(e.palette).filter(Le(["light"])).map(([t])=>({props:{colorSeverity:t,variant:"standard"},style:{color:e.vars?e.vars.palette.Alert[`${t}Color`]:o(e.palette[t].light,.6),backgroundColor:e.vars?e.vars.palette.Alert[`${t}StandardBg`]:r(e.palette[t].light,.9),[`& .${Te.icon}`]:e.vars?{color:e.vars.palette.Alert[`${t}IconColor`]}:{color:e.palette[t].main}}})),...Object.entries(e.palette).filter(Le(["light"])).map(([t])=>({props:{colorSeverity:t,variant:"outlined"},style:{color:e.vars?e.vars.palette.Alert[`${t}Color`]:o(e.palette[t].light,.6),border:`1px solid ${(e.vars||e).palette[t].light}`,[`& .${Te.icon}`]:e.vars?{color:e.vars.palette.Alert[`${t}IconColor`]}:{color:e.palette[t].main}}})),...Object.entries(e.palette).filter(Le(["dark"])).map(([t])=>({props:{colorSeverity:t,variant:"filled"},style:{fontWeight:e.typography.fontWeightMedium,...e.vars?{color:e.vars.palette.Alert[`${t}FilledColor`],backgroundColor:e.vars.palette.Alert[`${t}FilledBg`]}:{backgroundColor:e.palette.mode==="dark"?e.palette[t].dark:e.palette[t].main,color:e.palette.getContrastText(e.palette[t].main)}}}))]}})),Dt=be("div",{name:"MuiAlert",slot:"Icon"})({marginRight:12,padding:"7px 0",display:"flex",fontSize:22,opacity:.9}),_t=be("div",{name:"MuiAlert",slot:"Message"})({padding:"8px 0",minWidth:0,overflow:"auto"}),It=be("div",{name:"MuiAlert",slot:"Action"})({display:"flex",alignItems:"flex-start",padding:"4px 0 0 16px",marginLeft:"auto",marginRight:-8}),$e={success:n.jsx(Pt,{fontSize:"inherit"}),warning:n.jsx(Lt,{fontSize:"inherit"}),error:n.jsx(kt,{fontSize:"inherit"}),info:n.jsx(jt,{fontSize:"inherit"})},Re=L.forwardRef(function(o,r){const t=Ue({props:o,name:"MuiAlert"}),{action:s,children:i,className:p,closeText:y="Close",color:c,components:d={},componentsProps:m={},icon:h,iconMapping:A=$e,onClose:E,role:F="alert",severity:I="success",slotProps:k={},slots:D={},variant:$="standard",..._}=t,g={...t,color:c,severity:I,variant:$,colorSeverity:c||I},j=At(g),G={slots:{closeButton:d.CloseButton,closeIcon:d.CloseIcon,...D},slotProps:{...m,...k}},[R,W]=ce("root",{ref:r,shouldForwardComponentProp:!0,className:Ge(j.root,p),elementType:Et,externalForwardedProps:{...G,..._},ownerState:g,additionalProps:{role:F,elevation:0}}),[H,oe]=ce("icon",{className:j.icon,elementType:Dt,externalForwardedProps:G,ownerState:g}),[ye,fe]=ce("message",{className:j.message,elementType:_t,externalForwardedProps:G,ownerState:g}),[ie,re]=ce("action",{className:j.action,elementType:It,externalForwardedProps:G,ownerState:g}),[ae,B]=ce("closeButton",{elementType:Ze,externalForwardedProps:G,ownerState:g}),[ge,se]=ce("closeIcon",{elementType:Ft,externalForwardedProps:G,ownerState:g});return n.jsxs(R,{...W,children:[h!==!1?n.jsx(H,{...oe,children:h||A[I]||$e[I]}):null,n.jsx(ye,{...fe,children:i}),s!=null?n.jsx(ie,{...re,children:s}):null,s==null&&E?n.jsx(ie,{...re,children:n.jsx(ae,{size:"small","aria-label":y,title:y,color:"inherit",onClick:E,...B,children:n.jsx(ge,{fontSize:"small",...se})})}):null]})});function zt(e){return Ne("MuiFormGroup",e)}Oe("MuiFormGroup",["root","row","error"]);const Tt=e=>{const{classes:o,row:r,error:t}=e;return We({root:["root",r&&"row",t&&"error"]},zt,o)},$t=be("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:r}=e;return[o.root,r.row&&o.row]}})({display:"flex",flexDirection:"column",flexWrap:"wrap",variants:[{props:{row:!0},style:{flexDirection:"row"}}]}),Rt=L.forwardRef(function(o,r){const t=Ue({props:o,name:"MuiFormGroup"}),{className:s,row:i=!1,...p}=t,y=xt(),c=wt({props:t,muiFormControl:y,states:["error"]}),d={...t,row:i,error:c.error},m=Tt(d);return n.jsx($t,{className:Ge(m.root,s),ownerState:d,ref:r,...p})});/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Bt=qe("outline","trash","IconTrash",[["path",{d:"M4 7l16 0",key:"svg-0"}],["path",{d:"M10 11l0 6",key:"svg-1"}],["path",{d:"M14 11l0 6",key:"svg-2"}],["path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12",key:"svg-3"}],["path",{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3",key:"svg-4"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ot=qe("outline","x","IconX",[["path",{d:"M18 6l-12 12",key:"svg-0"}],["path",{d:"M6 6l12 12",key:"svg-1"}]]),q=63710088e-1,Je={centimeters:q*100,centimetres:q*100,degrees:360/(2*Math.PI),feet:q*3.28084,inches:q*39.37,kilometers:q/1e3,kilometres:q/1e3,meters:q,metres:q,miles:q/1609.344,millimeters:q*1e3,millimetres:q*1e3,nauticalmiles:q/1852,radians:1,yards:q*1.0936};function Se(e,o,r={}){const t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=o||{},t.geometry=e,t}function Me(e,o,r={}){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Be(e[0])||!Be(e[1]))throw new Error("coordinates must contain numbers");return Se({type:"Point",coordinates:e},o,r)}function Nt(e,o,r={}){if(e.length<2)throw new Error("coordinates must be an array of two or more positions");return Se({type:"LineString",coordinates:e},o,r)}function Ut(e,o="kilometers"){const r=Je[o];if(!r)throw new Error(o+" units is invalid");return e*r}function Gt(e,o="kilometers"){const r=Je[o];if(!r)throw new Error(o+" units is invalid");return e/r}function Ee(e){return e%(2*Math.PI)*180/Math.PI}function ee(e){return e%360*Math.PI/180}function Be(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function xe(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return[...e.geometry.coordinates];if(e.type==="Point")return[...e.coordinates]}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return[...e];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Wt(e){return e.type==="Feature"?e.geometry:e}function Ke(e,o,r={}){if(r.final===!0)return Ht(e,o);const t=xe(e),s=xe(o),i=ee(t[0]),p=ee(s[0]),y=ee(t[1]),c=ee(s[1]),d=Math.sin(p-i)*Math.cos(c),m=Math.cos(y)*Math.sin(c)-Math.sin(y)*Math.cos(c)*Math.cos(p-i);return Ee(Math.atan2(d,m))}function Ht(e,o){let r=Ke(o,e);return r=(r+180)%360,r}function qt(e,o,r,t={}){const s=xe(e),i=ee(s[0]),p=ee(s[1]),y=ee(r),c=Gt(o,t.units),d=Math.asin(Math.sin(p)*Math.cos(c)+Math.cos(p)*Math.sin(c)*Math.cos(y)),m=i+Math.atan2(Math.sin(y)*Math.sin(c)*Math.cos(p),Math.cos(c)-Math.sin(p)*Math.sin(d)),h=Ee(m),A=Ee(d);return Me([h,A],t.properties)}function Xe(e,o,r={}){var t=xe(e),s=xe(o),i=ee(s[1]-t[1]),p=ee(s[0]-t[0]),y=ee(t[1]),c=ee(s[1]),d=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(p/2),2)*Math.cos(y)*Math.cos(c);return Ut(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)),r.units)}function je(e,o,r={}){const s=Wt(e).coordinates;let i=0;for(let p=0;p<s.length&&!(o>=i&&p===s.length-1);p++)if(i>=o){const y=o-i;if(y){const c=Ke(s[p],s[p-1])-180;return qt(s[p],y,c,r)}else return Me(s[p])}else i+=Xe(s[p],s[p+1],r);return Me(s[s.length-1])}function De(e,o,r){if(e!==null)for(var t,s,i,p,y,c,d,m=0,h=0,A,E=e.type,F=E==="FeatureCollection",I=E==="Feature",k=F?e.features.length:1,D=0;D<k;D++){d=F?e.features[D].geometry:I?e.geometry:e,A=d?d.type==="GeometryCollection":!1,y=A?d.geometries.length:1;for(var $=0;$<y;$++){var _=0,g=0;if(p=A?d.geometries[$]:d,p!==null){c=p.coordinates;var j=p.type;switch(m=r&&(j==="Polygon"||j==="MultiPolygon")?1:0,j){case null:break;case"Point":if(o(c,h,D,_,g)===!1)return!1;h++,_++;break;case"LineString":case"MultiPoint":for(t=0;t<c.length;t++){if(o(c[t],h,D,_,g)===!1)return!1;h++,j==="MultiPoint"&&_++}j==="LineString"&&_++;break;case"Polygon":case"MultiLineString":for(t=0;t<c.length;t++){for(s=0;s<c[t].length-m;s++){if(o(c[t][s],h,D,_,g)===!1)return!1;h++}j==="MultiLineString"&&_++,j==="Polygon"&&g++}j==="Polygon"&&_++;break;case"MultiPolygon":for(t=0;t<c.length;t++){for(g=0,s=0;s<c[t].length;s++){for(i=0;i<c[t][s].length-m;i++){if(o(c[t][s][i],h,D,_,g)===!1)return!1;h++}g++}_++}break;case"GeometryCollection":for(t=0;t<p.geometries.length;t++)if(De(p.geometries[t],o,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Vt(e,o){var r,t,s,i,p,y,c,d,m,h,A=0,E=e.type==="FeatureCollection",F=e.type==="Feature",I=E?e.features.length:1;for(r=0;r<I;r++){for(y=E?e.features[r].geometry:F?e.geometry:e,d=E?e.features[r].properties:F?e.properties:{},m=E?e.features[r].bbox:F?e.bbox:void 0,h=E?e.features[r].id:F?e.id:void 0,c=y?y.type==="GeometryCollection":!1,p=c?y.geometries.length:1,s=0;s<p;s++){if(i=c?y.geometries[s]:y,i===null){if(o(null,A,d,m,h)===!1)return!1;continue}switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(o(i,A,d,m,h)===!1)return!1;break}case"GeometryCollection":{for(t=0;t<i.geometries.length;t++)if(o(i.geometries[t],A,d,m,h)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}A++}}function Yt(e,o){Vt(e,function(r,t,s,i,p){var y=r===null?null:r.type;switch(y){case null:case"Point":case"LineString":case"Polygon":return o(Se(r,s,{bbox:i,id:p}),t,0)===!1?!1:void 0}var c;switch(y){case"MultiPoint":c="Point";break;case"MultiLineString":c="LineString";break;case"MultiPolygon":c="Polygon";break}for(var d=0;d<r.coordinates.length;d++){var m=r.coordinates[d],h={type:c,coordinates:m};if(o(Se(h,s),t,d)===!1)return!1}})}function Zt(e,o){Yt(e,function(r,t,s){var i=0;if(r.geometry){var p=r.geometry.type;if(!(p==="Point"||p==="MultiPoint")){var y,c=0,d=0,m=0;if(De(r,function(h,A,E,F,I){if(y===void 0||t>c||F>d||I>m){y=h,c=t,d=F,m=I,i=0;return}var k=Nt([y,h],r.properties);if(o(k,t,s,I,i)===!1)return!1;i++,y=h})===!1)return!1}}})}function Jt(e,o,r){var t=r,s=!1;return Zt(e,function(i,p,y,c,d){s===!1&&r===void 0?t=i:t=o(t,i,p,y,c,d),s=!0}),t}function Fe(e,o={}){let r=0,t=0,s=0;return De(e,function(i){r+=i[0],t+=i[1],s++},!0),Me([r/s,t/s],o.properties)}function Ce(e,o={}){return Jt(e,(r,t)=>{const s=t.geometry.coordinates;return r+Xe(s[0],s[1],o)},0)}const Kt=({open:e=!1,onClose:o,onSave:r})=>{const[t,s]=L.useState(null),[i,p]=L.useState(!1),[y,c]=L.useState(0),[d,m]=L.useState({date:new Date().toISOString().split("T")[0],file:null}),{enqueueSnackbar:h}=st(),A=le(g=>g.auth.token),E=le(g=>g.project.selectedProjectId);L.useEffect(()=>{e||(s(null),p(!1),c(0),m({date:new Date().toISOString().split("T")[0],file:null}))},[e]);const F=(g,j)=>{m(G=>({...G,[g]:j}))},I=g=>{g.length&&(s(g[0]),F("file",g[0]))},{getRootProps:k,getInputProps:D,isDragActive:$}=gt({onDrop:I,multiple:!1,accept:{"application/zip":[".zip"]}}),_=async()=>{var g,j,G;if(!d.file){h("Please select a file to upload.",{variant:"warning"});return}p(!0),c(0);try{const W=(await U.post("/work-day/get-url",{projectId:E,name:d.date,filename:d.file.name,contentType:d.file.type,size:d.file.size},{headers:{Authorization:A}})).data.data;if(console.log(W),W.uploadType==="single")await U.put(W.url,d.file,{headers:{"Content-Type":d.file.type},onUploadProgress:H=>{const oe=Math.round(H.loaded*100/H.total);c(oe)}});else if(W.uploadType==="multipart"){const{parts:H,uploadId:oe,key:ye,partSize:fe}=W,ie=[];let re=0;for(;re<d.file.size;){const B=Math.min(re+fe,d.file.size);ie.push(t.slice(re,B)),re=B}const ae=[];for(let B=0;B<H.length;B++){const se=(g=(await fetch(H[B].url,{method:"PUT",body:ie[B]})).headers.get("ETag"))==null?void 0:g.replace(/"/g,"");ae.push({PartNumber:H[B].partNumber,ETag:se});const Y=Math.round((B+1)/H.length*100);c(Y)}await U.post("/work-day/complete-upload",{projectId:E,name:d.date,key:ye,uploadId:oe,parts:ae},{headers:{Authorization:A}})}h("Upload successful!",{variant:"success"}),W.uploadType==="single"&&h("SuccessFully Created Historical Data",{variant:"success"}),r&&r(),o()}catch(R){console.log(R),h(((G=(j=R==null?void 0:R.response)==null?void 0:j.data)==null?void 0:G.message)||R.message||"Upload failed.",{variant:"error"})}finally{p(!1),c(0)}};return n.jsx(nt,{open:e,onClose:o,children:n.jsxs(X,{sx:{outline:"none",width:400,maxWidth:"90vw",bgcolor:"background.paper",borderRadius:2,boxShadow:24,mx:"auto",mt:"10vh",p:3},children:[n.jsx(ne,{variant:"h5",sx:{mb:2},children:"Upload New Capture Into Historical Data"}),n.jsxs(X,{sx:{display:"flex",flexDirection:"column",gap:2},children:[n.jsx(Ve,{label:"Date of Capture",type:"date",value:d.date,onChange:g=>F("date",g.target.value),fullWidth:!0,size:"small",disabled:i,InputLabelProps:{shrink:!0}}),n.jsxs(X,{...k(),sx:{border:"2px dashed #ccc",borderRadius:"8px",padding:4,textAlign:"center",cursor:i?"not-allowed":"pointer",backgroundColor:$?"#f0f0f0":"transparent",mb:2,opacity:i?.5:1,pointerEvents:i?"none":"auto"},children:[n.jsx("input",{...D()}),n.jsx(mt,{size:32}),n.jsx(ne,{variant:"h6",gutterBottom:!0,children:"Upload Zip File"}),n.jsx(ne,{variant:"body2",sx:{mb:2},children:"Drag & drop your .zip file or click below to browse"}),n.jsx(ue,{variant:"outlined",disabled:i,children:"Browse Files"}),t&&n.jsxs(ne,{variant:"subtitle1",sx:{mt:1},children:["Selected: ",t.name]})]}),i&&n.jsxs(X,{children:[n.jsxs(ne,{variant:"body2",gutterBottom:!0,children:["Uploading... ",y,"%"]}),n.jsx(it,{variant:"determinate",value:y})]}),n.jsxs(X,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[n.jsx(ue,{onClick:o,disabled:i,children:"Cancel"}),n.jsx(ue,{variant:"contained",onClick:_,disabled:!d.file||i,startIcon:i&&n.jsx(Ye,{size:16}),children:i?"Uploading...":"Upload"})]})]})]})})},Xt=({commentInput:e,setCommentInput:o,addCommentLayer:r,setCommentFeatures:t,commentFeatures:s,handleDeleteComment:i,workDay:p,drawRef:y})=>{var h,A,E,F,I;const c=le(k=>k.auth.user),d=le(k=>k.auth.token),m=async(k,D)=>{try{const $=`comment-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,_={...e.feature},g={..._,type:"Feature",geometry:D||_.geometry,properties:{..._.properties,id:$,workDayId:p.id,comment:k,type:"comment",createdAt:new Date().toISOString(),createdBy:c}},j={geometry:g.geometry,properties:g.properties,featureType:g.properties.type,workDayId:p.id};(await U.post("/mapFeature",j,{headers:{Authorization:d}})).status===201&&Q("Successfully Added Comment",{variant:"success"}),t(R=>[...R,g]),console.log(g,"<=== yeets"),y.add(g),o({open:!1,feature:null,isEdit:!1,position:{x:0,y:0}})}catch($){console.error($)}};return n.jsx(lt,{in:e.open,children:n.jsxs(He,{elevation:4,sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:2e3,p:1.5,width:250,backgroundColor:"#ffffff",border:"1px solid #e0e0e0",borderRadius:1.5},children:[n.jsxs(X,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[n.jsx(ne,{variant:"subtitle2",sx:{fontSize:"0.875rem"},children:e.isEdit?"Edit Comment":"Add Comment"}),n.jsx(Ze,{size:"small",onClick:()=>o({open:!1,feature:null,isEdit:!1,position:{x:0,y:0}}),sx:{p:.5},children:n.jsx(Ot,{size:14})})]}),n.jsx(Ve,{autoFocus:!0,size:"small",fullWidth:!0,variant:"outlined",multiline:!0,rows:2,placeholder:"Enter comment...",value:((A=(h=e.feature)==null?void 0:h.properties)==null?void 0:A.comment)||"",onChange:k=>{if(e.feature){const D={...e.feature,properties:{...e.feature.properties,comment:k.target.value}};o({...e,feature:D})}},sx:{mb:1}}),n.jsxs(X,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[e.isEdit&&e.feature&&n.jsx(ue,{size:"small",variant:"contained",color:"error",startIcon:n.jsx(Bt,{size:14}),onClick:()=>{i(e.feature)},sx:{fontSize:"0.75rem",py:.5},children:"Delete"}),n.jsx(ue,{size:"small",variant:"contained",onClick:()=>{var k,D;return m(((D=(k=e.feature)==null?void 0:k.properties)==null?void 0:D.comment)||"")},disabled:!((I=(F=(E=e.feature)==null?void 0:E.properties)==null?void 0:F.comment)!=null&&I.trim()),sx:{fontSize:"0.75rem",py:.5},children:e.isEdit?"Update":"Add"})]})]})})};class Qt{constructor(o){if(typeof o=="function")this.onChange=o,this.initialColor="#3bb2d0",this.initialOpacity=.2;else{const{onChange:r,initialColor:t="#3bb2d0",initialOpacity:s=.2}=o||{};this.onChange=r,this.initialColor=t,this.initialOpacity=s}this._map=null,this._container=null,this._isOpen=!1,this._color=this.initialColor,this._opacity=this.initialOpacity}onAdd(o){this._map=o;const r=document.createElement("div");r.className="mapboxgl-ctrl mapboxgl-ctrl-group",r.style.position="relative";const t=document.createElement("button");t.type="button",t.className="mapboxgl-ctrl-icon",t.setAttribute("aria-label","Color & Opacity"),t.style.width="30px",t.style.height="30px",t.style.display="inline-flex",t.style.alignItems="center",t.style.justifyContent="center";const s=document.createElement("span");s.style.width="14px",s.style.height="14px",s.style.borderRadius="50%",s.style.background=this._color,s.style.opacity=this._opacity,s.style.boxShadow="0 0 0 1px rgba(0,0,0,0.2) inset",t.appendChild(s),this._dot=s;const i=document.createElement("div");i.style.position="absolute",i.style.top="0",i.style.right="100%",i.style.marginRight="8px",i.style.display="none",i.style.flexDirection="column",i.style.gap="8px",i.style.padding="8px",i.style.background="#fff",i.style.border="1px solid rgba(0,0,0,0.15)",i.style.borderRadius="8px",i.style.boxShadow="0 2px 8px rgba(0,0,0,0.12)",i.style.zIndex="2",i.style.width="140px";const p=document.createElement("input");p.type="color",p.value=this._color,p.style.width="100%",p.addEventListener("input",m=>{this._color=m.target.value,this._update()});const y=document.createElement("div");y.style.display="flex",y.style.flexDirection="column",y.style.fontSize="12px",y.style.gap="4px";const c=document.createElement("span");c.textContent=`Opacity: ${Math.round(this._opacity*100)}%`;const d=document.createElement("input");return d.type="range",d.min="0.1",d.max="1",d.step="0.05",d.value=this._opacity,d.addEventListener("input",m=>{this._opacity=parseFloat(m.target.value),c.textContent=`Opacity: ${Math.round(this._opacity*100)}%`,this._update()}),y.appendChild(c),y.appendChild(d),i.appendChild(p),i.appendChild(y),t.addEventListener("click",m=>{m.stopPropagation(),this._isOpen=!this._isOpen,i.style.display=this._isOpen?"flex":"none"}),document.addEventListener("click",m=>{r.contains(m.target)||(this._isOpen=!1,i.style.display="none")}),r.appendChild(t),r.appendChild(i),this._container=r,r}onRemove(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._map=null}_update(){this._dot&&(this._dot.style.background=this._color,this._dot.style.opacity=this._opacity),typeof this.onChange=="function"&&this.onChange(this._color,this._opacity)}}V.accessToken="pk.eyJ1IjoiaGlyYWtyYWoiLCJhIjoiY21icXd5eHRnMDNtaTJxczcxd2RmbTZwOCJ9.P6kpsuLMDdeK2DIMJZMrmw";const eo=[{title:"Projects",to:"/project",icon:dt},{title:"Project Name",icon:vt},{title:"Exterior(Map View)",icon:pt}],de=({label:e,createdBy:o,createdAt:r})=>`
    <div style="
      font-family: 'Arial', sans-serif;
      background-color: #fff;
      border: 1px solid #B3D3F0; /* secondary200 */
      border-radius: 8px;
      overflow: hidden;
      width: 200px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    ">
      <!-- Header -->
      <div style="
        background-color: #2563EB; /* primaryMain */
        color: #fff;
        font-weight: 600;
        font-size: 13px;
        padding: 8px;
        text-align: center;
        display: flex;
        justify-content: center;
        align-items: center;
      ">
        ${e}
      </div>
      
      <!-- Body -->
      <div style="
        padding: 6px 8px;
        background-color: #D6E6F5; /* secondaryLight */
        display: flex;
        justify-content: space-between;
        font-size: 8px;
        color: #1F3F66; /* secondary800 */
      ">
        <span>${o}</span>
        <span style="color: #666;">
          ${new Date(r).toLocaleDateString()} ${new Date(r).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}
        </span>
      </div>
    </div>
  `,pe=(e,o)=>{let r,t;return console.log(e,"<===== props"),e.createdBy?r=e.createdBy:r=JSON.parse(e.user_createdBy),e.createdAt?t=e.createdAt:t=e.user_createdAt,console.log(r,"<=======user"),console.log(t,"<=======daet"),{createdBy:`${r.firstName} ${r.lastName}`,createdAt:new Date(t),label:o}};function mo(){const e=L.useRef(null),o=L.useRef(null),r=L.useRef(null),t=le(l=>l.auth.user),[s,i]=L.useState(!1),[p,y]=L.useState(""),[c,d]=L.useState({orthomosaic:!0,annotations:!0,showComments:!0,showPolygons:!0,showLineString:!0,builtinOverlay:!1}),[m,h]=L.useState(!1),[A,E]=L.useState([]),[F,I]=L.useState([]),[k,D]=L.useState(!1),[$,_]=L.useState({}),[g,j]=L.useState(null),[G,R]=L.useState(!1),[W,H]=L.useState([]),[oe,ye]=L.useState("#2563EB"),[fe,ie]=L.useState(.5),[re,ae]=L.useState({open:!1,feature:null,isEdit:!1,position:{x:0,y:0}}),[B,ge]=L.useState([]),se=le(l=>l.project.selectedProjectId),Y=le(l=>l.auth.token);L.useEffect(()=>{if(!se)return;(async()=>{var u,f,x,z,O,P,v,w;try{D(!0),j(null);const b=((f=(u=(await U.get("/work-day",{params:{projectId:se,status:"completed"},headers:{Authorization:Y}})).data)==null?void 0:u.data)==null?void 0:f.results)||[];if(E(b.map(a=>a.name)),_(b[0]),I(b),b.length>0){y(b[0].name);const a=await U.get("/mapFeature",{params:{workDayId:b[0].id},headers:{Authorization:Y}});((z=(x=a.data)==null?void 0:x.data)==null?void 0:z.results.length)!==0&&H((P=(O=a.data)==null?void 0:O.data)==null?void 0:P.results)}else j("No completed work days found for this project.")}catch(C){j(((w=(v=C.response)==null?void 0:v.data)==null?void 0:w.message)||"Failed to load project data. Please try again."),E([]),I([])}finally{D(!1)}})()},[se,Y]),L.useEffect(()=>{if(!e.current||o.current)return;if(!V.accessToken){j("Mapbox API key is not configured.");return}const l=new V.Map({container:e.current,style:"mapbox://styles/mapbox/satellite-streets-v12",center:[72.5714,23.0225],zoom:15,attributionControl:!1,preserveDrawingBuffer:!0,minZoom:0,maxZoom:23}),u=oe,f=fe;var x=oe,z=f;const O=(P,v)=>{const w=["coalesce",["get","user_color"],["get","color"],P],C=["coalesce",["get","user_opacity"],["get","opacity"],v];return[{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","$type","Polygon"],["==","active","true"]],paint:{"fill-color":w,"fill-outline-color":w,"fill-opacity":C}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","$type","Polygon"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":w,"line-width":1}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],paint:{"line-color":w,"line-width":1}},{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","$type","Polygon"],["==","active","false"]],paint:{"fill-color":w,"fill-outline-color":w,"fill-opacity":C}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","$type","Polygon"],["==","active","false"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":w,"line-width":1}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","$type","LineString"],["==","active","false"]],paint:{"line-color":w,"line-width":2}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","false"]],paint:{"circle-radius":4,"circle-color":w}},{id:"gl-draw-point-comment",type:"circle",filter:["all",["==","active","false"],["==","meta","feature"],["==","user_type","comment"]],paint:{"circle-radius":4,"circle-color":w,"circle-stroke-color":"#fff","circle-stroke-width":2}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":6,"circle-color":w,"circle-stroke-color":w,"circle-stroke-width":2}},{id:"gl-draw-point-comment-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["==","meta","feature"],["==","user_type","comment"]],paint:{"circle-radius":6,"circle-color":w,"circle-stroke-color":"#fff","circle-stroke-width":3}}]};return l.on("load",()=>{o.current=l,i(!0),j(null),l.addControl(new V.FullscreenControl,"top-right"),l.addControl(new V.NavigationControl({visualizePitch:!0}),"top-right");const P=new V.ScaleControl({unit:"metric",maxWidth:100});l.addControl(P,"bottom-left"),setTimeout(()=>{const C=l.getContainer().querySelector(".mapboxgl-ctrl-scale");C&&(C.style.display="block",C.style.visibility="visible",C.style.opacity="1")},1e3);const v=new Qt((C,b)=>{console.log(C,b,"<==== picked"),x=C||u,z=b||f,console.log(x,"<==== current"),ye(C),ie(b)});l.addControl(v,"top-right");const w=new yt({userProperties:!0,displayControlsDefault:!1,controls:{polygon:!0,line_string:!0,point:!0,trash:!0},styles:O(x,z)});l.addControl(w,"top-right"),r.current=w,l.on("draw.create",async C=>{var N;const b=$.id;C.features.forEach(S=>{w.setFeatureProperty(S.id,"color",x)});const a=(N=C.features)==null?void 0:N[0];if(a){if(o.current.__activePopup&&o.current.__activePopup.remove(),a.geometry.type==="LineString"){if(!a||a.geometry.type!=="LineString")return;const Z=`${Ce(a,{units:"meters"}).toFixed(2)} m`,J=`polygon-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;a.properties.createdBy=t,a.properties.createdAt=new Date,a.createdAt=new Date().toISOString,a.properties.comment=Z,a.properties.color=x,a.properties.id=J;try{const M={featureType:"line",geometry:a.geometry,properties:a.properties,workDayId:b};(await U.post("/mapFeature",M,{headers:{Authorization:Y}})).status===201&&Q("Line created ",{variant:"success"}),w.add(a)}catch(M){console.error(M)}Q(Z,{variant:"success"})}if(a.geometry.type==="Polygon"){const S=ke.geometry(a.geometry).toFixed(2),Z=`${S} m²`,J=`polygon-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,M=Fe(a).geometry.coordinates;w.setFeatureProperty(a.id,"id",J),a.properties.color=x,a.properties.createdAt=new Date,a.properties.createdBy=t,a.properties.areaM2=S,a.properties.id=J,a.properties.opacity=z;try{const T={featureType:"polygon",geometry:a.geometry,properties:a.properties,workDayId:b};(await U.post("/mapFeature",T,{headers:{Authorization:Y}})).status===201&&Q("Polygon created ",{variant:"success"}),setTimeout(()=>{const te=new V.Popup({closeButton:!0,offset:15}).setLngLat(M).setHTML(de(pe(a.properties,Z))).addTo(o.current);o.current.__activePopup=te,w.add(a)},0)}catch(T){console.error(T)}}if(a.geometry.type==="Point"){const S=l.getCanvas().getBoundingClientRect();ae({open:!0,feature:{feature:a,geometry:a.geometry,color:x,properties:{color:x}},isEdit:!1,position:{x:S.width/2,y:S.height/2}})}}}),l.on("draw.update",async C=>{var N,S,Z,J;o.current.__activePopup&&o.current.__activePopup.remove(),console.log("updating something");const b=$.id,a=(N=C.features)==null?void 0:N[0];if(a){if(C.features.forEach(M=>{w.setFeatureProperty(M.id,"color",x)}),((S=a==null?void 0:a.geometry)==null?void 0:S.type)==="Polygon"){const M=ke.geometry(a.geometry),T=(M/1e6).toFixed(2),K=M.toFixed(2);Fe(a).geometry.coordinates,o.current.__activePopup=popup,a.properties.color=x,a.properties.areaKm2=T,a.properties.areaM2=K,a.properties.opacity=z;try{const te={featureType:"polygon",geometry:a.geometry,properties:a.properties,workDayId:b};(await U.patch(`/mapFeature/propertyId/${a==null?void 0:a.properties.id}`,te,{headers:{Authorization:Y}})).status===200&&Q("Polygon Updated ",{variant:"success"})}catch(te){console.error(te)}}if(((Z=a==null?void 0:a.geometry)==null?void 0:Z.type)==="LineString")try{const M=Ce(a,{units:"kilometers"}),T=(M*1e3).toFixed(2),K=je(a,M/2,{units:"kilometers"}).geometry.coordinates;a.properties.color=x,a.properties.lengthKm=M.toFixed(2),a.properties.lengthM=T;const te={featureType:"line",geometry:a.geometry,properties:a.properties,workDayId:b};(await U.patch(`/mapFeature/propertyId/${a==null?void 0:a.properties.id}`,te,{headers:{Authorization:Y}})).status===200&&Q("Line Updated",{variant:"success"})}catch(M){console.error("Error updating line:",M)}if(((J=a==null?void 0:a.geometry)==null?void 0:J.type)==="Point")try{const[M,T]=a.geometry.coordinates;a.properties.color=x,a.properties.coordinates=`${T.toFixed(6)}, ${M.toFixed(6)}`;const K={featureType:"comment",geometry:a.geometry,properties:a.properties,workDayId:b};(await U.patch(`/mapFeature/propertyId/${a==null?void 0:a.properties.id}`,K,{headers:{Authorization:Y}})).status===200&&Q("Point Updated",{variant:"success"})}catch(M){console.error("Error updating point:",M)}}}),l.on("draw.delete",async C=>{ge(a=>a.filter(N=>N.properties.id!==b.properties.id)),console.log("on delete"),o.current.__activePopup&&o.current.__activePopup.remove();const b=C.features[0];console.log("Deleted features:",C.features);try{(await U.delete(`/mapfeature/propertyId/${b.properties.id}`)).status===200&&Q("Successfully removed feature",{variant:"success"})}catch(a){console.error("error removing feature",a)}}),l.on("click",C=>{var Z,J;console.log("on click"),o.current.__activePopup&&o.current.__activePopup.remove();const b=["gl-draw-line-inactive","gl-draw-line-inactive.hot","gl-draw-line-active","gl-draw-line-active.hot","gl-draw-line-static","gl-draw-point-inactive","gl-draw-point-inactive.hot","gl-draw-point-active","gl-draw-point-active.hot","gl-draw-point-static","gl-draw-polygon-fill-inactive","gl-draw-polygon-fill-inactive.cold","gl-draw-polygon-fill-inactive.hot","gl-draw-polygon-fill-active","gl-draw-polygon-fill-static","gl-draw-polygon-stroke-inactive","gl-draw-polygon-stroke-inactive.cold","gl-draw-polygon-stroke-active","gl-draw-polygon-stroke-static"],a=l.getStyle().layers.map(M=>M.id).filter(M=>b.includes(M)),N=l.queryRenderedFeatures(C.point,{layers:a});if(!N.length)return;const S=N[0];if(S.geometry.type==="Point"&&S.properties.user_type==="comment"){console.log(S,"<==== yeeter");const M=S.geometry.coordinates.slice(),T=((Z=S.properties)==null?void 0:Z.comment)||((J=S.properties)==null?void 0:J.user_comment)||"",K=new V.Popup().setLngLat(M).setHTML(de(pe(S.properties,T))).addTo(l);o.current.__activePopup=K}if(S.geometry.type==="Polygon"){console.log(S,"<=== featuer agae ");const T=`${ke.geometry(S.geometry).toFixed(2)} m²`,K=Fe(S).geometry.coordinates;new V.Popup().setLngLat(K).setHTML(de(pe(S.properties,T))).addTo(l)}if(S.geometry.type==="LineString"){console.log(S,"<==== feature line string selection");const M=Ce(S,{units:"kilometers"}),T=je(S,M/2,{units:"kilometers"}).geometry.coordinates,K=M*1e3,te=`${K.toFixed(2)} m`;if(T&&!T.some(Number.isNaN)){const Pe=new V.Popup().setLngLat(T).setHTML(de(pe(S.properties,te))).addTo(l);o.current.__activePopup=Pe}Q(`Length: ${K.toFixed(2)} m`,{variant:"success"})}}),l.on("draw.selectionchange",C=>{if(C.features.length>0){const b=C.features[0];if(b.geometry.type==="LineString"&&b.properties.mode!=="draw_polygon"){console.log(b,"<==== feature line string selection");const a=Ce(b,{units:"kilometers"}),N=je(b,a/2,{units:"kilometers"}).geometry.coordinates,S=a*1e3,Z=`${S.toFixed(2)} m`;if(N&&!N.some(Number.isNaN)){const J=new V.Popup().setLngLat(N).setHTML(de(pe(b.properties,Z))).addTo(l);o.current.__activePopup=J}Q(`Length: ${S.toFixed(2)} m`,{variant:"success"})}if(b.geometry.type==="Point"){console.log(b,"<============wew");const a=new V.Popup().setLngLat(b.geometry.coordinates).setHTML(de(pe(b.properties,b.properties.comment))).addTo(l);o.current.__activePopup=a}}})}),l.on("sourcedata",P=>{var v;(v=P.sourceId)!=null&&v.includes("ortho-")&&P.isSourceLoaded&&(console.log("on source data remove"),R(!1))}),()=>{l&&l.remove&&l.remove(),o.current=null,i(!1)}},[$]),L.useEffect(()=>{if(!p||!o.current||!s||!F.length)return;(async()=>{var f;const u=F.find(x=>x.name===p);if(u){r.current.deleteAll();try{const{data:x}=await U.get("/mapFeature",{params:{workDayId:u.id,limit:100},headers:{Authorization:Y}}),O={type:"FeatureCollection",features:(((f=x==null?void 0:x.data)==null?void 0:f.results)||[]).map(({geometry:P,properties:v,createdBy:w,createdAt:C})=>({type:"Feature",geometry:P,properties:{...v,createdBy:w,createdAt:C,comment:(v==null?void 0:v.comment)||"",color:(v==null?void 0:v.color)||oe,message:(v==null?void 0:v.message)||"No message set"}}))};console.log(O.features,"<======== yeeeter"),ge(O.features)}catch(x){console.error("Error loading map features:",x)}}})()},[p,s,F]),L.useEffect(()=>{const l=F.find(P=>P.name===p);if(!o.current||!s||!l)return;const u=o.current,f=`overlay-${l.id}`,x={fill:`overlay-fill-${l.id}`,line:`overlay-line-${l.id}`,point:`overlay-point-${l.id}`};Object.values(x).forEach(P=>{u.getLayer(P)&&u.removeLayer(P)}),u.getSource(f)&&u.removeSource(f),r.current&&r.current.deleteAll();const z=B.filter(P=>{var v;return(v=P.properties)==null?void 0:v.overlay}),O=B.filter(P=>{var v;return!((v=P.properties)!=null&&v.overlay)});if(r.current&&O.length){const P=O.filter(v=>{var C;const w=(C=v.geometry)==null?void 0:C.type;return w==="Polygon"&&c.showPolygons||w==="LineString"&&c.showLineString||w==="Point"&&c.showComments});P.length&&c.annotations&&(r.current.add({type:"FeatureCollection",features:P}),r.current.changeMode("simple_select"))}if(c.builtinOverlay&&z.length&&(u.addSource(f,{type:"geojson",data:{type:"FeatureCollection",features:z}}),c.showPolygons&&u.addLayer({id:x.fill,type:"fill",source:f,filter:["==",["geometry-type"],"Polygon"],paint:{"fill-color":["coalesce",["get","color_hex"],"#2563EB"],"fill-opacity":.3}}),c.showLineString&&u.addLayer({id:x.line,type:"line",source:f,filter:["==",["geometry-type"],"LineString"],paint:{"line-color":["coalesce",["get","color_hex"],"#2563EB"],"line-width":1,"line-join":"round","line-cap":"round"}}),c.showComments&&u.addLayer({id:x.point,type:"circle",source:f,filter:["==",["geometry-type"],"Point"],paint:{"circle-radius":3,"circle-color":["coalesce",["get","color_hex"],"#2563EB"]}})),c.orthomosaic&&l.tileBaseUrl&&(R(!0),Qe(l)),l.tileBounds)et(l.tileBounds);else if(z.length){const P=new V.LngLatBounds;z.forEach(v=>{v.geometry.type==="Point"?P.extend(v.geometry.coordinates):v.geometry.type==="LineString"?v.geometry.coordinates.forEach(w=>P.extend(w)):v.geometry.type==="Polygon"&&v.geometry.coordinates.flat().forEach(w=>P.extend(w))}),P.isEmpty()||u.fitBounds(P,{padding:40})}},[B,c,s,p,F]);const Qe=l=>{const u=o.current;if(!u||!l.tileBaseUrl)return;const f=`ortho-${l.id}`;try{u.getLayer(f)&&u.removeLayer(f),u.getSource(f)&&u.removeSource(f),u.addSource(f,{type:"raster",tiles:[`${l.tileBaseUrl}/{z}/{x}/{y}.png`],tileSize:256,minzoom:10,maxzoom:23});const x=u.getStyle().layers.find(z=>z.id.startsWith("gl-draw-")).id;u.addLayer({id:f,type:"raster",source:f,paint:{"raster-opacity":c.orthomosaic?1:0,"raster-brightness-min":0,"raster-brightness-max":1}},x),console.log("Raster layer added:",f,"URL:",l.tileBaseUrl),setTimeout(()=>{const z=u.getLayer(f),O=u.getSource(f);console.log("Layer check:",{layerExists:!!z,sourceExists:!!O,layerVisible:u.getLayoutProperty(f,"visibility")!=="none",paintOpacity:u.getPaintProperty(f,"raster-opacity")})},1e3),R(!1)}catch(x){console.error("Error adding tile layer:",x),j("Failed to load orthomosaic tiles."),R(!1)}},et=l=>{const u=o.current;if(!u)return;const{north:f,south:x,east:z,west:O}=l;u.fitBounds([[O,x],[z,f]],{padding:50,maxZoom:18})},me=l=>{d(u=>({...u,[l.target.name]:l.target.checked}))},tt=l=>{y(l.target.value);const u=F.find(f=>f.name===l.target.value);_(u)},ot=l=>{const u=o.current;if(!(!u||!s)){if(console.log("Updating comment layer with features:",l),u.getLayer("comment-points")&&(console.log("Removing existing comment layer"),u.removeLayer("comment-points")),u.getSource("comments")&&(console.log("Removing existing comment source"),u.removeSource("comments")),console.log("checking features ",l),l&&l.length>0&&c.showComments){console.log("Adding new comment layer with",l.length,"features"),u.addSource("comments",{type:"geojson",data:{type:"FeatureCollection",features:l}}),u.addLayer({id:"comment-points",type:"symbol",source:"comments",layout:{"icon-image":"marker-15","icon-size":1.5,"text-field":["get","comment"],"text-offset":[0,1.5],"text-anchor":"top"},paint:{"text-size":.5,"text-color":"#000","text-halo-color":"#fff","text-halo-width":2}});const f=u.getLayer("comment-points");f&&console.log("Comment layer added successfully with ID:",f.id)}else console.log("No features to display, comment layer removed");u.isStyleLoaded()&&u.triggerRepaint(),console.log("Comment layer update complete")}},rt=async l=>{console.log("=== COMMENT DELETION DEBUG ==="),console.log("Attempting to delete comment",l),console.log("Current commentFeatures:",W),console.log(W[0].properties.comment),console.log(l.properties.comment);const u=W.filter(f=>f.properties.id!==l.properties.id);try{await U.delete(`/mapFeature/propertyId/${l.properties.id}`,{headers:{Authorization:Y}})}catch(f){console.error(f)}console.log("Updated commentFeatures after deletion:",u),Q("Successfully Removed Comment",{variant:"success"}),H(u),refreshCommentLayer(),ae({open:!1,feature:null,isEdit:!1,position:{x:0,y:0}}),console.log("=== END DELETION DEBUG ===")};return se?n.jsxs(ze,{children:[n.jsxs(X,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[n.jsx(ne,{variant:"h1",gutterBottom:!0,children:"Exterior (Map View)"}),n.jsx(ue,{variant:"contained",onClick:()=>h(!0),disabled:k,children:"Upload New"})]}),n.jsx(Kt,{open:m,onClose:()=>h(!1)}),n.jsx(ct,{links:eo,card:!0,custom:!0,rightAlign:!1}),n.jsx(ut,{sx:{my:2}}),n.jsxs(X,{display:"flex",height:"calc(100vh - 320px)",gap:1,children:[n.jsxs(X,{sx:{width:"250px",pr:2,height:"100%"},children:[n.jsx(ne,{onClick:()=>{const l=o.current.queryRenderedFeatures();console.log("Total Rendered Features:",l.length);const u=o.current.queryRenderedFeatures({layers:["overlay-fill-68ad75d9366cff02d631be9f","overlay-line-68ad75d9366cff02d631be9f","overlay-point-68ad75d9366cff02d631be9f"]});console.log("Overlay Rendered Features:",u.length)},variant:"h3",gutterBottom:!0,children:"Layers"}),n.jsxs(Rt,{children:[n.jsx(he,{control:n.jsx(ve,{checked:c.orthomosaic,onChange:me,name:"orthomosaic",disabled:k}),label:"Orthomosaic"}),n.jsx(he,{control:n.jsx(ve,{checked:c.showLineString,onChange:me,name:"showLineString",disabled:k}),label:"Lines"}),n.jsx(he,{control:n.jsx(ve,{checked:c.showPolygons,onChange:me,name:"showPolygons",disabled:k}),label:"Polygons"}),n.jsx(he,{control:n.jsx(ve,{checked:c.showComments,onChange:me,name:"showComments",disabled:k}),label:"Comments"}),n.jsx(he,{control:n.jsx(ve,{checked:c.builtinOverlay,onChange:me,name:"builtinOverlay",disabled:k}),label:"Built-in Overlay"})]}),n.jsxs(bt,{fullWidth:!0,sx:{mt:3},children:[n.jsx(ht,{children:"Historical Data"}),n.jsx(Ct,{value:p||"",onChange:tt,label:"Historical Data",disabled:k||A.length===0,children:A.map(l=>n.jsx(St,{value:l,children:ft(l).format("DD-MM-YYYY")},l))})]}),k&&n.jsx(X,{sx:{display:"flex",justifyContent:"center",mt:2},children:n.jsx(Ye,{size:24})}),!k&&A.length===0&&n.jsx(Re,{severity:"info",sx:{mt:2},children:"No historical data available for this project."})]}),n.jsx(X,{ref:e,sx:{flex:1,borderRadius:2,overflow:"hidden",height:"100%",position:"relative",border:"1px solid #e0e0e0","& .mapboxgl-ctrl-scale":{border:"2px solid #333",borderTop:"none",color:"#333",backgroundColor:"rgba(255, 255, 255, 0.8)",padding:"2px 6px",fontSize:"12px",fontWeight:"bold"}}}),n.jsx(Xt,{addCommentLayer:ot,setCommentFeatures:H,commentInput:re,setCommentInput:ae,commentFeatures:W,handleDeleteComment:rt,workDay:$,drawRef:r.current})]})]}):n.jsx(ze,{children:n.jsx(Re,{severity:"warning",children:"No project selected. Please select a project first."})})}export{mo as default};
