import{z as F,j as e,u as _,b as D,r as x,d as k,N as H,B as P,T as I,av as L,aw as W,ax as O,bk as V,Z as $,W as N,M as u,k as q,bf as U,bg as Z,bh as G,bi as f,ba as r,bj as J,x as K,a3 as Q,i as X,b7 as Y,l as b}from"./index-BS7x6V1Y.js";const ee=F(e.jsx("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"})),ae=()=>{const l=_(),{enqueueSnackbar:d}=D(),[y,m]=x.useState([]),[j,T]=x.useState(""),[w,z]=x.useState("viewer"),[B,S]=x.useState(!0),[C,p]=x.useState(null),g=k(s=>s.project.id),h=k(s=>s.auth.token);x.useEffect(()=>{if(!g)return;(async()=>{var n,i,o;S(!0);try{const t=await b.get("/project-members",{params:{projectId:g},headers:{Authorization:h}});m(((n=t.data.data)==null?void 0:n.results)||[])}catch(t){p(((o=(i=t.response)==null?void 0:i.data)==null?void 0:o.message)||t.message)}finally{S(!1)}})()},[g,h]);const E=async()=>{var n,i,o,t;if(!j)return;let s=j.trim();T("");try{const a=await b.post("/project-members",{projectId:g,email:s,role:w,status:"invited"},{headers:{Authorization:h}});m(c=>[...c,a.data.data]),z("viewer"),d("Team member invited successfully!",{variant:"success"})}catch(a){p(((i=(n=a.response)==null?void 0:n.data)==null?void 0:i.message)||a.message),d(((t=(o=a.response)==null?void 0:o.data)==null?void 0:t.message)||a.message||"Failed to invite member",{variant:"error"})}},A=async(s,n)=>{var i,o,t,a;try{await b.patch(`/project-members/${s}`,{role:n},{headers:{Authorization:h}}),m(c=>c.map(v=>v._id===s||v.id===s?{...v,role:n}:v)),d("Role updated successfully!",{variant:"success"})}catch(c){p(((o=(i=c.response)==null?void 0:i.data)==null?void 0:o.message)||c.message),d(((a=(t=c.response)==null?void 0:t.data)==null?void 0:a.message)||c.message||"Failed to update role",{variant:"error"})}},M=async s=>{var n,i,o,t;try{await b.delete(`/project-members/${s}`,{headers:{Authorization:h}}),m(y.filter(a=>a._id!==s)),d("Team member removed successfully!",{variant:"success"})}catch(a){p(((i=(n=a.response)==null?void 0:n.data)==null?void 0:i.message)||a.message),d(((t=(o=a.response)==null?void 0:o.data)==null?void 0:t.message)||a.message||"Failed to remove member",{variant:"error"})}},R=[{title:"Projects",to:"/project",icon:W},{title:"Project Name",to:"/project/1/View",icon:O},{title:"Project Team",icon:V}];return e.jsxs(H,{children:[e.jsxs(P,{children:[e.jsx(I,{variant:"h1",gutterBottom:!0,children:"Project Team"}),e.jsx(L,{links:R,card:!0,custom:!0,rightAlign:!1})]}),B?e.jsx(I,{variant:"body1",children:"Loading team members..."}):C?e.jsx(I,{color:"error",children:C}):e.jsxs($,{sx:{p:3,mx:"auto",mt:3,boxShadow:4},children:[e.jsxs(P,{sx:{display:"flex",gap:2,mb:3,alignItems:"center"},children:[e.jsx(N,{label:"Invite by Email",size:"small",value:j,onChange:s=>T(s.target.value),sx:{flex:1}}),e.jsxs(N,{select:!0,label:"Permission",size:"small",value:w,onChange:s=>z(s.target.value),sx:{flex:1,minWidth:120},children:[e.jsx(u,{value:"editor",children:"editor"}),e.jsx(u,{value:"viewer",children:"viewer"})]}),e.jsx(q,{variant:"contained",color:"primary",startIcon:e.jsx(ee,{}),onClick:E,disabled:!j,children:"Invite"})]}),e.jsx(U,{children:e.jsxs(Z,{size:"small",children:[e.jsx(G,{children:e.jsxs(f,{sx:{bgcolor:l.palette.primary.light},children:[e.jsx(r,{sx:{color:l.palette.primary.contrastText},children:"Email"}),e.jsx(r,{sx:{color:l.palette.primary.contrastText},children:"Name"}),e.jsx(r,{sx:{color:l.palette.primary.contrastText},children:"Organization"}),e.jsx(r,{sx:{color:l.palette.primary.contrastText},children:"Designation"}),e.jsx(r,{sx:{color:l.palette.primary.contrastText},children:"Permission"}),e.jsx(r,{sx:{color:l.palette.primary.contrastText},children:"Status"}),e.jsx(r,{align:"center",sx:{color:l.palette.primary.contrastText},children:"Action"})]})}),e.jsxs(J,{children:[y.map(s=>{var n,i,o,t;return e.jsxs(f,{children:[e.jsx(r,{children:s.email}),e.jsx(r,{children:s.userId?s.userId.firstName+" "+s.userId.lastName:"Not Registered"}),e.jsx(r,{children:(n=s.userId)!=null&&n.organization?(i=s.userId)==null?void 0:i.organization:"Not Registered"}),e.jsx(r,{children:(o=s.userId)!=null&&o.designation?(t=s.userId)==null?void 0:t.designation:"Not Registered"}),e.jsx(r,{children:e.jsxs(K,{size:"small",value:s.role,onChange:a=>A(s._id,a.target.value),sx:{minWidth:90},disabled:s.role==="owner",children:[e.jsx(u,{value:"editor",children:"editor"}),e.jsx(u,{value:"viewer",children:"viewer"}),s.role==="owner"?e.jsx(u,{value:"owner",children:"owner"}):null]})}),e.jsx(r,{children:e.jsx(Q,{label:s.status,color:s.status==="active"?"success":"warning",size:"small"})}),e.jsx(r,{align:"center",children:e.jsx(X,{color:"error",onClick:()=>M(s._id),children:e.jsx(Y,{})})})]},s.id)}),y.length===0&&e.jsx(f,{children:e.jsx(r,{colSpan:4,align:"center",sx:{color:l.palette.text.disabled},children:"No team members yet."})})]})]})})]})]})};export{ae as default};
