import{z as J,j as e,a as V,c as K,r as h,R as Q,B as T,T as M,i as ee,U as te,M as F,V as ne,S as w,k as P,W as se,m as ae,d as re,G as D,X as ie,F as oe,I as ce,x as le,Y as ue,Z as de,_ as he,$ as fe,a0 as me,a1 as xe,a2 as ge,l as Y,a3 as X}from"./index-D7lqPC1g.js";import{P as je}from"./Person-BDmFtcm2.js";import{C as De,M as Me}from"./MoreVert-J11eufwr.js";import{t as p,c as Se,n as W,g as _,a as ve,e as ye,m as L,b as z}from"./en-US-CRQByS1p.js";import{e as be,a as Ce}from"./endOfMonth-4FTE1eXr.js";const Ie=J(e.jsx("path",{d:"M22 16V4c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2m-11-4 2.03 2.71L16 11l4 5H8zM2 6v14c0 1.1.9 2 2 2h14v-2H4V6z"}));function O(t,i){const n=+p(t)-+p(i);return n<0?-1:n>0?1:n}function we(t){return Se(t,Date.now())}function Pe(t,i,n){const[o,s]=W(n==null?void 0:n.in,t,i),l=o.getFullYear()-s.getFullYear(),u=o.getMonth()-s.getMonth();return l*12+u}function Te(t){return i=>{const o=(t?Math[t]:Math.trunc)(i);return o===0?0:o}}function pe(t,i){return+p(t)-+p(i)}function ke(t,i){const n=p(t,i==null?void 0:i.in);return+be(n,i)==+Ce(n,i)}function ze(t,i,n){const[o,s,l]=W(n==null?void 0:n.in,t,t,i),u=O(s,l),r=Math.abs(Pe(s,l));if(r<1)return 0;s.getMonth()===1&&s.getDate()>27&&s.setDate(30),s.setMonth(s.getMonth()-u*r);let g=O(s,l)===-u;ke(o)&&r===1&&O(o,l)===1&&(g=!1);const j=u*(r-+g);return j===0?0:j}function Oe(t,i,n){const o=pe(t,i)/1e3;return Te(n==null?void 0:n.roundingMethod)(o)}function Ae(t,i,n){const o=ve(),s=(n==null?void 0:n.locale)??o.locale??ye,l=2520,u=O(t,i);if(isNaN(u))throw new RangeError("Invalid time value");const r=Object.assign({},n,{addSuffix:n==null?void 0:n.addSuffix,comparison:u}),[g,j]=W(n==null?void 0:n.in,...u>0?[i,t]:[t,i]),f=Oe(j,g),S=(_(j)-_(g))/1e3,a=Math.round((f-S)/60);let m;if(a<2)return n!=null&&n.includeSeconds?f<5?s.formatDistance("lessThanXSeconds",5,r):f<10?s.formatDistance("lessThanXSeconds",10,r):f<20?s.formatDistance("lessThanXSeconds",20,r):f<40?s.formatDistance("halfAMinute",0,r):f<60?s.formatDistance("lessThanXMinutes",1,r):s.formatDistance("xMinutes",1,r):a===0?s.formatDistance("lessThanXMinutes",1,r):s.formatDistance("xMinutes",a,r);if(a<45)return s.formatDistance("xMinutes",a,r);if(a<90)return s.formatDistance("aboutXHours",1,r);if(a<L){const x=Math.round(a/60);return s.formatDistance("aboutXHours",x,r)}else{if(a<l)return s.formatDistance("xDays",1,r);if(a<z){const x=Math.round(a/L);return s.formatDistance("xDays",x,r)}else if(a<z*2)return m=Math.round(a/z),s.formatDistance("aboutXMonths",m,r)}if(m=ze(j,g),m<12){const x=Math.round(a/z);return s.formatDistance("xMonths",x,r)}else{const x=m%12,v=Math.trunc(m/12);return x<3?s.formatDistance("aboutXYears",v,r):x<9?s.formatDistance("overXYears",v,r):s.formatDistance("almostXYears",v+1,r)}}function Xe(t,i){return Ae(t,we(t),i)}const Fe="/assets/conture-map-DVTY2EDp.jpg",We=({project:t,count:i,onDelete:n})=>{const o=V(),s=K(),[l,u]=h.useState(null),r=!!l,g=a=>{a.stopPropagation(),u(a.currentTarget)},j=a=>{a.stopPropagation(),u(null)},f=a=>{a.stopPropagation(),u(null),n&&n(t)},S=()=>{const a=t._id||t.id;s(se({id:a,name:t.name})),o(`/project/${a}/View`)};return e.jsxs(Q,{elevation:4,sx:{maxHeight:220,position:"relative",width:320,maxWidth:320,borderRadius:3,overflow:"hidden",cursor:"pointer",transition:"0.3s","&:hover":{boxShadow:6}},onClick:S,children:[e.jsxs(T,{sx:{position:"relative",height:140},children:[e.jsx(De,{component:"img",height:"140",image:Fe,alt:t==null?void 0:t.name,sx:{objectFit:"cover",filter:"brightness(60%)"}}),e.jsx(T,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",px:2},children:e.jsx(M,{variant:"subtitle1",fontWeight:700,color:"white",noWrap:!0,children:t==null?void 0:t.name})}),e.jsx(ee,{size:"small",onClick:g,sx:{position:"absolute",top:5,right:5,color:"white",backgroundColor:"rgba(0,0,0,0.4)","&:hover":{backgroundColor:"rgba(0,0,0,0.6)"}},children:e.jsx(Me,{fontSize:"small"})}),e.jsx(te,{anchorEl:l,open:r,onClose:j,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(F,{onClick:f,children:"Delete Project"})})]}),e.jsx(ne,{sx:{pt:1,pb:1},children:e.jsxs(w,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(w,{direction:"row",spacing:2,alignItems:"center",children:[e.jsxs(w,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(Ie,{fontSize:"small"}),e.jsx(M,{variant:"caption",children:t==null?void 0:t.location})]}),e.jsxs(w,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(je,{fontSize:"small"}),e.jsx(M,{variant:"caption",children:i})]}),e.jsx(w,{children:e.jsx(M,{variant:"caption",fontSize:8,color:"text.secondary",children:t!=null&&t.createdAt?`${Xe(new Date(t==null?void 0:t.createdAt),{addSuffix:!0})}`:"Time unknown"})})]}),e.jsx(P,{size:"small",onClick:a=>{a.stopPropagation(),S()},children:"View"})]})})]})};function Ve(){const t=ae(),i=V(),n=re(c=>c.auth),[o,s]=h.useState(""),[l,u]=h.useState(""),[r,g]=h.useState([]),[j,f]=h.useState(!1),[S,a]=h.useState(null),[m,x]=h.useState(1),[v,H]=h.useState(1),R=12,[$,k]=h.useState(!1),[b,B]=h.useState(null),[C,E]=h.useState(!1),A=async(c="",d="",Z=1)=>{var N;f(!0),a(null);try{const I={email:n.user.email,status:"active",page:Z,limit:R};c&&(I.search=c),d&&(I.sortBy=d);const y=(N=(await Y.get("/project-members",{params:I,headers:{Authorization:n.token}})).data)==null?void 0:N.data;g((y==null?void 0:y.results)||[]),H((y==null?void 0:y.totalPages)||1)}catch(I){a(I.message||"Failed to fetch projects")}finally{f(!1)}};h.useEffect(()=>{A(o,l,m)},[m]);const q=()=>{x(1),A(o,l,1)},G=async()=>{var c;if(b){E(!0);try{(await Y.delete(`/project/${b._id}`,{headers:{Authorization:n.token}})).status===200&&(X("Project deleted successfully",{variant:"success"}),A(o,l,m))}catch(d){console.log("Error deleting project:",d),((c=d==null?void 0:d.response)==null?void 0:c.status)===403?X("You do not have permission to delete this project",{variant:"error"}):X("Error deleting project",{variant:"error"})}finally{E(!1),k(!1),B(null)}}},U=c=>{B(c),k(!0)};return e.jsxs(T,{p:3,children:[e.jsxs(D,{container:!0,spacing:2,alignItems:"center",justifyContent:"space-between",mb:3,children:[e.jsx(D,{item:!0,xs:12,md:3,children:e.jsx(M,{variant:"h2",fontWeight:600,children:"All Projects"})}),e.jsx(D,{item:!0,xs:12,md:6,children:e.jsxs(D,{container:!0,justifyContent:"center",alignItems:"center",spacing:2,children:[e.jsx(D,{item:!0,xs:12,sm:6,children:e.jsx(ie,{label:"Search by Name",variant:"outlined",size:"small",fullWidth:!0,value:o,onChange:c=>s(c.target.value)})}),e.jsx(D,{item:!0,xs:12,sm:6,children:e.jsxs(oe,{sx:{...t.typography.customSelect2,minWidth:"100px"},fullWidth:!0,children:[e.jsx(ce,{children:"Sort By"}),e.jsxs(le,{size:"small",value:l,label:"Sort By",onChange:c=>u(c.target.value),children:[e.jsx(F,{value:"name",children:"Name"}),e.jsx(F,{value:"images",children:"Date"})]})]})}),e.jsx(D,{item:!0,xs:12,sm:2,children:e.jsx(P,{variant:"contained",fullWidth:!0,onClick:q,children:"Search"})})]})}),e.jsx(D,{item:!0,xs:12,md:3,textAlign:{xs:"left",md:"right"},children:e.jsx(P,{variant:"contained",onClick:()=>i("/createProject"),startIcon:e.jsx(ue,{}),color:"primary",children:"Create New Project"})})]}),j?e.jsx(M,{variant:"body1",children:"Loading projects..."}):S?e.jsx(M,{color:"error",children:S}):r.length===0?e.jsx(T,{mt:6,textAlign:"center",children:e.jsx(M,{variant:"h6",color:"text.secondary",children:"No projects found. Create a project to start working."})}):e.jsxs(e.Fragment,{children:[e.jsx(D,{container:!0,spacing:3,children:r.map((c,d)=>e.jsx(D,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsx(We,{project:c.projectId,count:c.memberCount,onDelete:U})},d))}),v>1&&e.jsx(T,{mt:4,display:"flex",justifyContent:"center",children:e.jsx(de,{count:v,page:m,onChange:(c,d)=>x(d),color:"primary"})})]}),e.jsxs(he,{open:$,onClose:()=>!C&&k(!1),fullWidth:!0,maxWidth:"xs",children:[e.jsx(fe,{children:"Delete Project"}),e.jsx(me,{children:e.jsxs(M,{children:["You are about to delete ",e.jsx("strong",{children:b==null?void 0:b.name}),". This action cannot be undone."]})}),e.jsxs(xe,{children:[e.jsx(P,{onClick:()=>k(!1),disabled:C,children:"Cancel"}),e.jsx(P,{color:"error",variant:"contained",onClick:G,disabled:C,startIcon:C?e.jsx(ge,{size:18}):null,children:C?"Deleting...":"Delete"})]})]})]})}export{Ve as default};
