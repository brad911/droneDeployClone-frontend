import{t as F,j as e,u as D,b as _,r as m,d as P,M as H,B,T as I,az as L,aA as O,b2 as V,af as W,ah as $,h as f}from"./index-CLShbHKG.js";import{D as q}from"./Delete-BTmuY0Xd.js";import{I as U}from"./IconBuildingCog-J3FpCQNs.js";import{T as k}from"./TextField-dVb_FRGK.js";import{M as x}from"./MenuItem-EtgtN3AO.js";import{B as G}from"./InputLabel-BtYDmk5J.js";import{a as J,b as K,c as Q,d as T,T as r,e as X}from"./TableRow-eRecScLI.js";import{S as Y}from"./Select-BOMWSliO.js";import{I as Z}from"./IconButton-Dl4YXc1J.js";import"./OutlinedInput-BN7h3DEh.js";import"./FormHelperText-CSILo6Cw.js";const ee=F(e.jsx("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"})),he=()=>{const l=D(),{enqueueSnackbar:d}=_(),[y,u]=m.useState([]),[p,b]=m.useState(""),[w,S]=m.useState("viewer"),[A,z]=m.useState(!0),[C,j]=m.useState(null),g=P(s=>s.project.selectedProjectId),h=P(s=>s.auth.token);m.useEffect(()=>{if(!g)return;(async()=>{var o,i,n;z(!0);try{const a=await f.get("/project-members",{params:{projectId:g},headers:{Authorization:h}});u(((o=a.data.data)==null?void 0:o.results)||[])}catch(a){j(((n=(i=a.response)==null?void 0:i.data)==null?void 0:n.message)||a.message)}finally{z(!1)}})()},[g,h]);const E=async()=>{var o,i,n,a;if(!p)return;let s=p.trim();b("");try{const t=await f.post("/project-members",{projectId:g,email:s,role:w,status:"invited"},{headers:{Authorization:h}});u(c=>[...c,t.data.data]),S("viewer"),d("Team member invited successfully!",{variant:"success"})}catch(t){j(((i=(o=t.response)==null?void 0:o.data)==null?void 0:i.message)||t.message),d(((a=(n=t.response)==null?void 0:n.data)==null?void 0:a.message)||t.message||"Failed to invite member",{variant:"error"})}},M=async(s,o)=>{var i,n,a,t;try{await f.patch(`/project-members/${s}`,{role:o},{headers:{Authorization:h}}),u(c=>c.map(v=>v._id===s||v.id===s?{...v,role:o}:v)),d("Role updated successfully!",{variant:"success"})}catch(c){j(((n=(i=c.response)==null?void 0:i.data)==null?void 0:n.message)||c.message),d(((t=(a=c.response)==null?void 0:a.data)==null?void 0:t.message)||c.message||"Failed to update role",{variant:"error"})}},N=async s=>{var o,i,n,a;try{await f.delete(`/project-members/${s}`,{headers:{Authorization:h}}),u(y.filter(t=>t._id!==s)),d("Team member removed successfully!",{variant:"success"})}catch(t){j(((i=(o=t.response)==null?void 0:o.data)==null?void 0:i.message)||t.message),d(((a=(n=t.response)==null?void 0:n.data)==null?void 0:a.message)||t.message||"Failed to remove member",{variant:"error"})}},R=[{title:"Projects",to:"/project",icon:O},{title:"Project Name",to:"/project/1/View",icon:U},{title:"Project Files",icon:V}];return e.jsxs(H,{children:[e.jsxs(B,{children:[e.jsx(I,{variant:"h1",gutterBottom:!0,children:"Project Team"}),e.jsx(L,{links:R,card:!0,custom:!0,rightAlign:!1})]}),A?e.jsx(I,{variant:"body1",children:"Loading team members..."}):C?e.jsx(I,{color:"error",children:C}):e.jsxs(W,{sx:{p:3,mx:"auto",mt:3,boxShadow:4},children:[e.jsxs(B,{sx:{display:"flex",gap:2,mb:3,alignItems:"center"},children:[e.jsx(k,{label:"Invite by Email",size:"small",value:p,onChange:s=>b(s.target.value),sx:{flex:1}}),e.jsxs(k,{select:!0,label:"Permission",size:"small",value:w,onChange:s=>S(s.target.value),sx:{flex:1,minWidth:120},children:[e.jsx(x,{value:"editor",children:"editor"}),e.jsx(x,{value:"viewer",children:"viewer"})]}),e.jsx(G,{variant:"contained",color:"primary",startIcon:e.jsx(ee,{}),onClick:E,disabled:!p,children:"Invite"})]}),e.jsx(J,{children:e.jsxs(K,{size:"small",children:[e.jsx(Q,{children:e.jsxs(T,{sx:{bgcolor:l.palette.primary.light},children:[e.jsx(r,{sx:{color:l.palette.primary.contrastText},children:"Email"}),e.jsx(r,{sx:{color:l.palette.primary.contrastText},children:"Name"}),e.jsx(r,{sx:{color:l.palette.primary.contrastText},children:"Organization"}),e.jsx(r,{sx:{color:l.palette.primary.contrastText},children:"Designation"}),e.jsx(r,{sx:{color:l.palette.primary.contrastText},children:"Permission"}),e.jsx(r,{sx:{color:l.palette.primary.contrastText},children:"Status"}),e.jsx(r,{align:"center",sx:{color:l.palette.primary.contrastText},children:"Action"})]})}),e.jsxs(X,{children:[y.map(s=>{var o,i,n,a;return e.jsxs(T,{children:[e.jsx(r,{children:s.email}),e.jsx(r,{children:s.userId?s.userId.firstName+" "+s.userId.lastName:"Not Registered"}),e.jsx(r,{children:(o=s.userId)!=null&&o.organization?(i=s.userId)==null?void 0:i.organization:"Not Registered"}),e.jsx(r,{children:(n=s.userId)!=null&&n.designation?(a=s.userId)==null?void 0:a.designation:"Not Registered"}),e.jsx(r,{children:e.jsxs(Y,{size:"small",value:s.role,onChange:t=>M(s._id,t.target.value),sx:{minWidth:90},disabled:s.role==="owner",children:[e.jsx(x,{value:"editor",children:"editor"}),e.jsx(x,{value:"viewer",children:"viewer"}),s.role==="owner"?e.jsx(x,{value:"owner",children:"owner"}):null]})}),e.jsx(r,{children:e.jsx($,{label:s.status,color:s.status==="active"?"success":"warning",size:"small"})}),e.jsx(r,{align:"center",children:e.jsx(Z,{color:"error",onClick:()=>N(s._id),children:e.jsx(q,{})})})]},s.id)}),y.length===0&&e.jsx(T,{children:e.jsx(r,{colSpan:4,align:"center",sx:{color:l.palette.text.disabled},children:"No team members yet."})})]})]})})]})]})};export{he as default};
