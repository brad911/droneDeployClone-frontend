import{V as Oe,U as Ne,t as me,j as i,r as k,aq as Ue,ar as le,y as he,Y as Ge,a7 as Ae,Z as We,af as He,as as rt,at as _e,au as Ie,av as ke,aw as qe,b as at,d as ie,ax as st,B as K,T as se,ay as nt,h as R,aa as it,al as X,M as ze,az as lt,aA as ct,aB as dt,D as pt}from"./index-DsMF7nGP.js";import{m as J}from"./mapbox-gl-DphC26XC.js";import{M as ut,g as Le}from"./index-oLIw9kUz.js";import{d as gt}from"./dayjs.min-Bm6CGlGB.js";import{u as ft,I as yt}from"./index-KnV9LfjZ.js";import{T as Ve}from"./TextField-Dd0I3wlN.js";import{B as pe,C as Ye,I as mt}from"./InputLabel-ByLwqljB.js";import{I as Ze}from"./IconButton-DSyzX8gY.js";import{I as ht}from"./IconBuildingCog-C2AmTevH.js";import{u as vt,f as xt,F as wt}from"./OutlinedInput-BXaV-Tfd.js";import{F as xe,C as we}from"./FormControlLabel-D7RXQ_sL.js";import{S as bt}from"./Select-D0SKNEq1.js";import{M as Ct}from"./MenuItem-CYeiS079.js";import"./FormHelperText-8d_j0jqG.js";function St(e){return Ne("MuiAlert",e)}const Te=Oe("MuiAlert",["root","action","icon","message","filled","colorSuccess","colorInfo","colorWarning","colorError","filledSuccess","filledInfo","filledWarning","filledError","outlined","outlinedSuccess","outlinedInfo","outlinedWarning","outlinedError","standard","standardSuccess","standardInfo","standardWarning","standardError"]),Mt=me(i.jsx("path",{d:"M20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4C12.76,4 13.5,4.11 14.2, 4.31L15.77,2.74C14.61,2.26 13.34,2 12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0, 0 22,12M7.91,10.08L6.5,11.5L11,16L21,6L19.59,4.58L11,13.17L7.91,10.08Z"})),Pt=me(i.jsx("path",{d:"M12 5.99L19.53 19H4.47L12 5.99M12 2L1 21h22L12 2zm1 14h-2v2h2v-2zm0-6h-2v4h2v-4z"})),kt=me(i.jsx("path",{d:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"})),Lt=me(i.jsx("path",{d:"M11,9H13V7H11M12,20C7.59,20 4,16.41 4,12C4,7.59 7.59,4 12,4C16.41,4 20,7.59 20, 12C20,16.41 16.41,20 12,20M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10, 10 0 0,0 12,2M11,17H13V11H11V17Z"})),jt=me(i.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})),Ft=e=>{const{variant:o,color:r,severity:t,classes:s}=e,n={root:["root",`color${Ae(r||t)}`,`${o}${Ae(r||t)}`,`${o}`],icon:["icon"],message:["message"],action:["action"]};return We(n,St,s)},At=he(He,{name:"MuiAlert",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:r}=e;return[o.root,o[r.variant],o[`${r.variant}${Ae(r.color||r.severity)}`]]}})(rt(({theme:e})=>{const o=e.palette.mode==="light"?_e:Ie,r=e.palette.mode==="light"?Ie:_e;return{...e.typography.body2,backgroundColor:"transparent",display:"flex",padding:"6px 16px",variants:[...Object.entries(e.palette).filter(ke(["light"])).map(([t])=>({props:{colorSeverity:t,variant:"standard"},style:{color:e.vars?e.vars.palette.Alert[`${t}Color`]:o(e.palette[t].light,.6),backgroundColor:e.vars?e.vars.palette.Alert[`${t}StandardBg`]:r(e.palette[t].light,.9),[`& .${Te.icon}`]:e.vars?{color:e.vars.palette.Alert[`${t}IconColor`]}:{color:e.palette[t].main}}})),...Object.entries(e.palette).filter(ke(["light"])).map(([t])=>({props:{colorSeverity:t,variant:"outlined"},style:{color:e.vars?e.vars.palette.Alert[`${t}Color`]:o(e.palette[t].light,.6),border:`1px solid ${(e.vars||e).palette[t].light}`,[`& .${Te.icon}`]:e.vars?{color:e.vars.palette.Alert[`${t}IconColor`]}:{color:e.palette[t].main}}})),...Object.entries(e.palette).filter(ke(["dark"])).map(([t])=>({props:{colorSeverity:t,variant:"filled"},style:{fontWeight:e.typography.fontWeightMedium,...e.vars?{color:e.vars.palette.Alert[`${t}FilledColor`],backgroundColor:e.vars.palette.Alert[`${t}FilledBg`]}:{backgroundColor:e.palette.mode==="dark"?e.palette[t].dark:e.palette[t].main,color:e.palette.getContrastText(e.palette[t].main)}}}))]}})),Dt=he("div",{name:"MuiAlert",slot:"Icon"})({marginRight:12,padding:"7px 0",display:"flex",fontSize:22,opacity:.9}),Et=he("div",{name:"MuiAlert",slot:"Message"})({padding:"8px 0",minWidth:0,overflow:"auto"}),_t=he("div",{name:"MuiAlert",slot:"Action"})({display:"flex",alignItems:"flex-start",padding:"4px 0 0 16px",marginLeft:"auto",marginRight:-8}),$e={success:i.jsx(Mt,{fontSize:"inherit"}),warning:i.jsx(Pt,{fontSize:"inherit"}),error:i.jsx(kt,{fontSize:"inherit"}),info:i.jsx(Lt,{fontSize:"inherit"})},Re=k.forwardRef(function(o,r){const t=Ue({props:o,name:"MuiAlert"}),{action:s,children:n,className:p,closeText:g="Close",color:l,components:d={},componentsProps:h={},icon:x,iconMapping:j=$e,onClose:A,role:F="alert",severity:_="success",slotProps:M={},slots:D={},variant:z="standard",...E}=t,y={...t,color:l,severity:_,variant:z,colorSeverity:l||_},P=Ft(y),B={slots:{closeButton:d.CloseButton,closeIcon:d.CloseIcon,...D},slotProps:{...h,...M}},[$,O]=le("root",{ref:r,shouldForwardComponentProp:!0,className:Ge(P.root,p),elementType:At,externalForwardedProps:{...B,...E},ownerState:y,additionalProps:{role:F,elevation:0}}),[N,re]=le("icon",{className:P.icon,elementType:Dt,externalForwardedProps:B,ownerState:y}),[ue,ge]=le("message",{className:P.message,elementType:Et,externalForwardedProps:B,ownerState:y}),[ne,te]=le("action",{className:P.action,elementType:_t,externalForwardedProps:B,ownerState:y}),[ae,T]=le("closeButton",{elementType:Ze,externalForwardedProps:B,ownerState:y}),[U,fe]=le("closeIcon",{elementType:jt,externalForwardedProps:B,ownerState:y});return i.jsxs($,{...O,children:[x!==!1?i.jsx(N,{...re,children:x||j[_]||$e[_]}):null,i.jsx(ue,{...ge,children:n}),s!=null?i.jsx(ne,{...te,children:s}):null,s==null&&A?i.jsx(ne,{...te,children:i.jsx(ae,{size:"small","aria-label":g,title:g,color:"inherit",onClick:A,...T,children:i.jsx(U,{fontSize:"small",...fe})})}):null]})});function It(e){return Ne("MuiFormGroup",e)}Oe("MuiFormGroup",["root","row","error"]);const zt=e=>{const{classes:o,row:r,error:t}=e;return We({root:["root",r&&"row",t&&"error"]},It,o)},Tt=he("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:r}=e;return[o.root,r.row&&o.row]}})({display:"flex",flexDirection:"column",flexWrap:"wrap",variants:[{props:{row:!0},style:{flexDirection:"row"}}]}),$t=k.forwardRef(function(o,r){const t=Ue({props:o,name:"MuiFormGroup"}),{className:s,row:n=!1,...p}=t,g=vt(),l=xt({props:t,muiFormControl:g,states:["error"]}),d={...t,row:n,error:l.error},h=zt(d);return i.jsx(Tt,{className:Ge(h.root,s),ownerState:d,ref:r,...p})});/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Rt=qe("outline","trash","IconTrash",[["path",{d:"M4 7l16 0",key:"svg-0"}],["path",{d:"M10 11l0 6",key:"svg-1"}],["path",{d:"M14 11l0 6",key:"svg-2"}],["path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12",key:"svg-3"}],["path",{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3",key:"svg-4"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Bt=qe("outline","x","IconX",[["path",{d:"M18 6l-12 12",key:"svg-0"}],["path",{d:"M6 6l12 12",key:"svg-1"}]]),G=63710088e-1,Je={centimeters:G*100,centimetres:G*100,degrees:360/(2*Math.PI),feet:G*3.28084,inches:G*39.37,kilometers:G/1e3,kilometres:G/1e3,meters:G,metres:G,miles:G/1609.344,millimeters:G*1e3,millimetres:G*1e3,nauticalmiles:G/1852,radians:1,yards:G*1.0936};function Ce(e,o,r={}){const t={type:"Feature"};return(r.id===0||r.id)&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.properties=o||{},t.geometry=e,t}function Se(e,o,r={}){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Be(e[0])||!Be(e[1]))throw new Error("coordinates must contain numbers");return Ce({type:"Point",coordinates:e},o,r)}function Ot(e,o,r={}){if(e.length<2)throw new Error("coordinates must be an array of two or more positions");return Ce({type:"LineString",coordinates:e},o,r)}function Nt(e,o="kilometers"){const r=Je[o];if(!r)throw new Error(o+" units is invalid");return e*r}function Ut(e,o="kilometers"){const r=Je[o];if(!r)throw new Error(o+" units is invalid");return e/r}function De(e){return e%(2*Math.PI)*180/Math.PI}function Q(e){return e%360*Math.PI/180}function Be(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function ye(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return[...e.geometry.coordinates];if(e.type==="Point")return[...e.coordinates]}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return[...e];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Gt(e){return e.type==="Feature"?e.geometry:e}function Ke(e,o,r={}){if(r.final===!0)return Wt(e,o);const t=ye(e),s=ye(o),n=Q(t[0]),p=Q(s[0]),g=Q(t[1]),l=Q(s[1]),d=Math.sin(p-n)*Math.cos(l),h=Math.cos(g)*Math.sin(l)-Math.sin(g)*Math.cos(l)*Math.cos(p-n);return De(Math.atan2(d,h))}function Wt(e,o){let r=Ke(o,e);return r=(r+180)%360,r}function Ht(e,o,r,t={}){const s=ye(e),n=Q(s[0]),p=Q(s[1]),g=Q(r),l=Ut(o,t.units),d=Math.asin(Math.sin(p)*Math.cos(l)+Math.cos(p)*Math.sin(l)*Math.cos(g)),h=n+Math.atan2(Math.sin(g)*Math.sin(l)*Math.cos(p),Math.cos(l)-Math.sin(p)*Math.sin(d)),x=De(h),j=De(d);return Se([x,j],t.properties)}function Xe(e,o,r={}){var t=ye(e),s=ye(o),n=Q(s[1]-t[1]),p=Q(s[0]-t[0]),g=Q(t[1]),l=Q(s[1]),d=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(p/2),2)*Math.cos(g)*Math.cos(l);return Nt(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)),r.units)}function je(e,o,r={}){const s=Gt(e).coordinates;let n=0;for(let p=0;p<s.length&&!(o>=n&&p===s.length-1);p++)if(n>=o){const g=o-n;if(g){const l=Ke(s[p],s[p-1])-180;return Ht(s[p],g,l,r)}else return Se(s[p])}else n+=Xe(s[p],s[p+1],r);return Se(s[s.length-1])}function Ee(e,o,r){if(e!==null)for(var t,s,n,p,g,l,d,h=0,x=0,j,A=e.type,F=A==="FeatureCollection",_=A==="Feature",M=F?e.features.length:1,D=0;D<M;D++){d=F?e.features[D].geometry:_?e.geometry:e,j=d?d.type==="GeometryCollection":!1,g=j?d.geometries.length:1;for(var z=0;z<g;z++){var E=0,y=0;if(p=j?d.geometries[z]:d,p!==null){l=p.coordinates;var P=p.type;switch(h=r&&(P==="Polygon"||P==="MultiPolygon")?1:0,P){case null:break;case"Point":if(o(l,x,D,E,y)===!1)return!1;x++,E++;break;case"LineString":case"MultiPoint":for(t=0;t<l.length;t++){if(o(l[t],x,D,E,y)===!1)return!1;x++,P==="MultiPoint"&&E++}P==="LineString"&&E++;break;case"Polygon":case"MultiLineString":for(t=0;t<l.length;t++){for(s=0;s<l[t].length-h;s++){if(o(l[t][s],x,D,E,y)===!1)return!1;x++}P==="MultiLineString"&&E++,P==="Polygon"&&y++}P==="Polygon"&&E++;break;case"MultiPolygon":for(t=0;t<l.length;t++){for(y=0,s=0;s<l[t].length;s++){for(n=0;n<l[t][s].length-h;n++){if(o(l[t][s][n],x,D,E,y)===!1)return!1;x++}y++}E++}break;case"GeometryCollection":for(t=0;t<p.geometries.length;t++)if(Ee(p.geometries[t],o,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function qt(e,o){var r,t,s,n,p,g,l,d,h,x,j=0,A=e.type==="FeatureCollection",F=e.type==="Feature",_=A?e.features.length:1;for(r=0;r<_;r++){for(g=A?e.features[r].geometry:F?e.geometry:e,d=A?e.features[r].properties:F?e.properties:{},h=A?e.features[r].bbox:F?e.bbox:void 0,x=A?e.features[r].id:F?e.id:void 0,l=g?g.type==="GeometryCollection":!1,p=l?g.geometries.length:1,s=0;s<p;s++){if(n=l?g.geometries[s]:g,n===null){if(o(null,j,d,h,x)===!1)return!1;continue}switch(n.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(o(n,j,d,h,x)===!1)return!1;break}case"GeometryCollection":{for(t=0;t<n.geometries.length;t++)if(o(n.geometries[t],j,d,h,x)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}j++}}function Vt(e,o){qt(e,function(r,t,s,n,p){var g=r===null?null:r.type;switch(g){case null:case"Point":case"LineString":case"Polygon":return o(Ce(r,s,{bbox:n,id:p}),t,0)===!1?!1:void 0}var l;switch(g){case"MultiPoint":l="Point";break;case"MultiLineString":l="LineString";break;case"MultiPolygon":l="Polygon";break}for(var d=0;d<r.coordinates.length;d++){var h=r.coordinates[d],x={type:l,coordinates:h};if(o(Ce(x,s),t,d)===!1)return!1}})}function Yt(e,o){Vt(e,function(r,t,s){var n=0;if(r.geometry){var p=r.geometry.type;if(!(p==="Point"||p==="MultiPoint")){var g,l=0,d=0,h=0;if(Ee(r,function(x,j,A,F,_){if(g===void 0||t>l||F>d||_>h){g=x,l=t,d=F,h=_,n=0;return}var M=Ot([g,x],r.properties);if(o(M,t,s,_,n)===!1)return!1;n++,g=x})===!1)return!1}}})}function Zt(e,o,r){var t=r,s=!1;return Yt(e,function(n,p,g,l,d){s===!1&&r===void 0?t=n:t=o(t,n,p,g,l,d),s=!0}),t}function Fe(e,o={}){let r=0,t=0,s=0;return Ee(e,function(n){r+=n[0],t+=n[1],s++},!0),Se([r/s,t/s],o.properties)}function be(e,o={}){return Zt(e,(r,t)=>{const s=t.geometry.coordinates;return r+Xe(s[0],s[1],o)},0)}const Jt=({open:e=!1,onClose:o,onSave:r})=>{const[t,s]=k.useState(null),[n,p]=k.useState(!1),[g,l]=k.useState(0),[d,h]=k.useState({date:new Date().toISOString().split("T")[0],file:null}),{enqueueSnackbar:x}=at(),j=ie(y=>y.auth.token),A=ie(y=>y.project.selectedProjectId);k.useEffect(()=>{e||(s(null),p(!1),l(0),h({date:new Date().toISOString().split("T")[0],file:null}))},[e]);const F=(y,P)=>{h(B=>({...B,[y]:P}))},_=y=>{y.length&&(s(y[0]),F("file",y[0]))},{getRootProps:M,getInputProps:D,isDragActive:z}=ft({onDrop:_,multiple:!1,accept:{"application/zip":[".zip"]}}),E=async()=>{var y,P,B;if(!d.file){x("Please select a file to upload.",{variant:"warning"});return}p(!0),l(0);try{const O=(await R.post("/work-day/get-url",{projectId:A,name:d.date,filename:d.file.name,contentType:d.file.type,size:d.file.size},{headers:{Authorization:j}})).data.data;if(console.log(O),O.uploadType==="single")await R.put(O.url,d.file,{headers:{"Content-Type":d.file.type},onUploadProgress:N=>{const re=Math.round(N.loaded*100/N.total);l(re)}});else if(O.uploadType==="multipart"){const{parts:N,uploadId:re,key:ue,partSize:ge}=O,ne=[];let te=0;for(;te<d.file.size;){const T=Math.min(te+ge,d.file.size);ne.push(t.slice(te,T)),te=T}const ae=[];for(let T=0;T<N.length;T++){const fe=(y=(await fetch(N[T].url,{method:"PUT",body:ne[T]})).headers.get("ETag"))==null?void 0:y.replace(/"/g,"");ae.push({PartNumber:N[T].partNumber,ETag:fe});const Me=Math.round((T+1)/N.length*100);l(Me)}await R.post("/work-day/complete-upload",{projectId:A,name:d.date,key:ue,uploadId:re,parts:ae},{headers:{Authorization:j}})}x("Upload successful!",{variant:"success"}),O.uploadType==="single"&&x("SuccessFully Created Historical Data",{variant:"success"}),r&&r(),o()}catch($){console.log($),x(((B=(P=$==null?void 0:$.response)==null?void 0:P.data)==null?void 0:B.message)||$.message||"Upload failed.",{variant:"error"})}finally{p(!1),l(0)}};return i.jsx(st,{open:e,onClose:o,children:i.jsxs(K,{sx:{outline:"none",width:400,maxWidth:"90vw",bgcolor:"background.paper",borderRadius:2,boxShadow:24,mx:"auto",mt:"10vh",p:3},children:[i.jsx(se,{variant:"h5",sx:{mb:2},children:"Upload New Capture Into Historical Data"}),i.jsxs(K,{sx:{display:"flex",flexDirection:"column",gap:2},children:[i.jsx(Ve,{label:"Date of Capture",type:"date",value:d.date,onChange:y=>F("date",y.target.value),fullWidth:!0,size:"small",disabled:n,InputLabelProps:{shrink:!0}}),i.jsxs(K,{...M(),sx:{border:"2px dashed #ccc",borderRadius:"8px",padding:4,textAlign:"center",cursor:n?"not-allowed":"pointer",backgroundColor:z?"#f0f0f0":"transparent",mb:2,opacity:n?.5:1,pointerEvents:n?"none":"auto"},children:[i.jsx("input",{...D()}),i.jsx(yt,{size:32}),i.jsx(se,{variant:"h6",gutterBottom:!0,children:"Upload Zip File"}),i.jsx(se,{variant:"body2",sx:{mb:2},children:"Drag & drop your .zip file or click below to browse"}),i.jsx(pe,{variant:"outlined",disabled:n,children:"Browse Files"}),t&&i.jsxs(se,{variant:"subtitle1",sx:{mt:1},children:["Selected: ",t.name]})]}),n&&i.jsxs(K,{children:[i.jsxs(se,{variant:"body2",gutterBottom:!0,children:["Uploading... ",g,"%"]}),i.jsx(nt,{variant:"determinate",value:g})]}),i.jsxs(K,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[i.jsx(pe,{onClick:o,disabled:n,children:"Cancel"}),i.jsx(pe,{variant:"contained",onClick:E,disabled:!d.file||n,startIcon:n&&i.jsx(Ye,{size:16}),children:n?"Uploading...":"Upload"})]})]})]})})},Kt=({commentInput:e,setCommentInput:o,addCommentLayer:r,setCommentFeatures:t,commentFeatures:s,handleDeleteComment:n,workDay:p,drawRef:g})=>{var x,j,A,F,_;const l=ie(M=>M.auth.user),d=ie(M=>M.auth.token),h=async(M,D)=>{try{const z=`comment-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,E={...e.feature},y={...E,type:"Feature",geometry:D||E.geometry,properties:{...E.properties,id:z,workDayId:p.id,comment:M,type:"comment",createdAt:new Date().toISOString(),createdBy:l}},P={geometry:y.geometry,properties:y.properties,featureType:y.properties.type,workDayId:p.id};(await R.post("/mapFeature",P,{headers:{Authorization:d}})).status===201&&X("Successfully Added Comment",{variant:"success"}),t($=>[...$,y]),console.log(y,"<=== yeets"),g.add(y),o({open:!1,feature:null,isEdit:!1,position:{x:0,y:0}})}catch(z){console.error(z)}};return i.jsx(it,{in:e.open,children:i.jsxs(He,{elevation:4,sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:2e3,p:1.5,width:250,backgroundColor:"#ffffff",border:"1px solid #e0e0e0",borderRadius:1.5},children:[i.jsxs(K,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:1},children:[i.jsx(se,{variant:"subtitle2",sx:{fontSize:"0.875rem"},children:e.isEdit?"Edit Comment":"Add Comment"}),i.jsx(Ze,{size:"small",onClick:()=>o({open:!1,feature:null,isEdit:!1,position:{x:0,y:0}}),sx:{p:.5},children:i.jsx(Bt,{size:14})})]}),i.jsx(Ve,{autoFocus:!0,size:"small",fullWidth:!0,variant:"outlined",multiline:!0,rows:2,placeholder:"Enter comment...",value:((j=(x=e.feature)==null?void 0:x.properties)==null?void 0:j.comment)||"",onChange:M=>{if(e.feature){const D={...e.feature,properties:{...e.feature.properties,comment:M.target.value}};o({...e,feature:D})}},sx:{mb:1}}),i.jsxs(K,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[e.isEdit&&e.feature&&i.jsx(pe,{size:"small",variant:"contained",color:"error",startIcon:i.jsx(Rt,{size:14}),onClick:()=>{n(e.feature)},sx:{fontSize:"0.75rem",py:.5},children:"Delete"}),i.jsx(pe,{size:"small",variant:"contained",onClick:()=>{var M,D;return h(((D=(M=e.feature)==null?void 0:M.properties)==null?void 0:D.comment)||"")},disabled:!((_=(F=(A=e.feature)==null?void 0:A.properties)==null?void 0:F.comment)!=null&&_.trim()),sx:{fontSize:"0.75rem",py:.5},children:e.isEdit?"Update":"Add"})]})]})})};class Xt{constructor(o){if(typeof o=="function")this.onChange=o,this.initialColor="#3bb2d0",this.initialOpacity=.2;else{const{onChange:r,initialColor:t="#3bb2d0",initialOpacity:s=.2}=o||{};this.onChange=r,this.initialColor=t,this.initialOpacity=s}this._map=null,this._container=null,this._isOpen=!1,this._color=this.initialColor,this._opacity=this.initialOpacity}onAdd(o){this._map=o;const r=document.createElement("div");r.className="mapboxgl-ctrl mapboxgl-ctrl-group",r.style.position="relative";const t=document.createElement("button");t.type="button",t.className="mapboxgl-ctrl-icon",t.setAttribute("aria-label","Color & Opacity"),t.style.width="30px",t.style.height="30px",t.style.display="inline-flex",t.style.alignItems="center",t.style.justifyContent="center";const s=document.createElement("span");s.style.width="14px",s.style.height="14px",s.style.borderRadius="50%",s.style.background=this._color,s.style.opacity=this._opacity,s.style.boxShadow="0 0 0 1px rgba(0,0,0,0.2) inset",t.appendChild(s),this._dot=s;const n=document.createElement("div");n.style.position="absolute",n.style.top="0",n.style.right="100%",n.style.marginRight="8px",n.style.display="none",n.style.flexDirection="column",n.style.gap="8px",n.style.padding="8px",n.style.background="#fff",n.style.border="1px solid rgba(0,0,0,0.15)",n.style.borderRadius="8px",n.style.boxShadow="0 2px 8px rgba(0,0,0,0.12)",n.style.zIndex="2",n.style.width="140px";const p=document.createElement("input");p.type="color",p.value=this._color,p.style.width="100%",p.addEventListener("input",h=>{this._color=h.target.value,this._update()});const g=document.createElement("div");g.style.display="flex",g.style.flexDirection="column",g.style.fontSize="12px",g.style.gap="4px";const l=document.createElement("span");l.textContent=`Opacity: ${Math.round(this._opacity*100)}%`;const d=document.createElement("input");return d.type="range",d.min="0.1",d.max="1",d.step="0.05",d.value=this._opacity,d.addEventListener("input",h=>{this._opacity=parseFloat(h.target.value),l.textContent=`Opacity: ${Math.round(this._opacity*100)}%`,this._update()}),g.appendChild(l),g.appendChild(d),n.appendChild(p),n.appendChild(g),t.addEventListener("click",h=>{h.stopPropagation(),this._isOpen=!this._isOpen,n.style.display=this._isOpen?"flex":"none"}),document.addEventListener("click",h=>{r.contains(h.target)||(this._isOpen=!1,n.style.display="none")}),r.appendChild(t),r.appendChild(n),this._container=r,r}onRemove(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._map=null}_update(){this._dot&&(this._dot.style.background=this._color,this._dot.style.opacity=this._opacity),typeof this.onChange=="function"&&this.onChange(this._color,this._opacity)}}J.accessToken="pk.eyJ1IjoiaGlyYWtyYWoiLCJhIjoiY21icXd5eHRnMDNtaTJxczcxd2RmbTZwOCJ9.P6kpsuLMDdeK2DIMJZMrmw";const Qt=[{title:"Projects",to:"/project",icon:ct},{title:"Project Name",icon:ht},{title:"Exterior(Map View)",icon:dt}],ce=({label:e,createdBy:o,createdAt:r})=>`
    <div style="
      font-family: 'Arial', sans-serif;
      background-color: #fff;
      border: 1px solid #B3D3F0; /* secondary200 */
      border-radius: 8px;
      overflow: hidden;
      width: 200px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    ">
      <!-- Header -->
      <div style="
        background-color: #2563EB; /* primaryMain */
        color: #fff;
        font-weight: 600;
        font-size: 13px;
        padding: 8px;
        text-align: center;
        display: flex;
        justify-content: center;
        align-items: center;
      ">
        ${e}
      </div>
      
      <!-- Body -->
      <div style="
        padding: 6px 8px;
        background-color: #D6E6F5; /* secondaryLight */
        display: flex;
        justify-content: space-between;
        font-size: 8px;
        color: #1F3F66; /* secondary800 */
      ">
        <span>${o}</span>
        <span style="color: #666;">
          ${new Date(r).toLocaleDateString()} ${new Date(r).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}
        </span>
      </div>
    </div>
  `,de=(e,o)=>{let r,t;return console.log(e,"<===== props"),e.createdBy?r=e.createdBy:r=JSON.parse(e.user_createdBy),e.createdAt?t=e.createdAt:t=e.user_createdAt,console.log(r,"<=======user"),console.log(t,"<=======daet"),{createdBy:`${r.firstName} ${r.lastName}`,createdAt:new Date(t),label:o}};function yo(){const e=k.useRef(null),o=k.useRef(null),r=k.useRef(null),t=ie(c=>c.auth.user),[s,n]=k.useState(!1),[p,g]=k.useState(""),[l,d]=k.useState({orthomosaic:!0,annotations:!0,showComments:!0,showPolygons:!0,showLineString:!0}),[h,x]=k.useState(!1),[j,A]=k.useState([]),[F,_]=k.useState([]),[M,D]=k.useState(!1),[z,E]=k.useState({}),[y,P]=k.useState(null),[B,$]=k.useState(!1),[O,N]=k.useState([]),[re,ue]=k.useState("#2563EB"),[ge,ne]=k.useState(.5),[te,ae]=k.useState({open:!1,feature:null,isEdit:!1,position:{x:0,y:0}}),T=ie(c=>c.project.selectedProjectId),U=ie(c=>c.auth.token);k.useEffect(()=>{if(!T)return;(async()=>{var u,m,L,S,oe,W,H,b;try{D(!0),P(null);const v=((m=(u=(await R.get("/work-day",{params:{projectId:T,status:"completed"},headers:{Authorization:U}})).data)==null?void 0:u.data)==null?void 0:m.results)||[];if(A(v.map(a=>a.name)),E(v[0]),_(v),v.length>0){g(v[0].name);const a=await R.get("/mapFeature",{params:{workDayId:v[0].id},headers:{Authorization:U}});((S=(L=a.data)==null?void 0:L.data)==null?void 0:S.results.length)!==0&&N((W=(oe=a.data)==null?void 0:oe.data)==null?void 0:W.results)}else P("No completed work days found for this project.")}catch(f){P(((b=(H=f.response)==null?void 0:H.data)==null?void 0:b.message)||"Failed to load project data. Please try again."),A([]),_([])}finally{D(!1)}})()},[T,U]),k.useEffect(()=>{if(!e.current||o.current)return;if(!J.accessToken){P("Mapbox API key is not configured.");return}const c=new J.Map({container:e.current,style:"mapbox://styles/mapbox/satellite-streets-v12",center:[72.5714,23.0225],zoom:15,attributionControl:!1,preserveDrawingBuffer:!0,minZoom:0,maxZoom:23}),u=re,m=ge;var L=re,S=m;const oe=(W,H)=>{const b=["coalesce",["get","user_color"],["get","color"],W],f=["coalesce",["get","user_opacity"],["get","opacity"],H];return[{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","$type","Polygon"],["==","active","true"]],paint:{"fill-color":b,"fill-outline-color":b,"fill-opacity":f}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","$type","Polygon"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":b,"line-width":1}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],paint:{"line-color":b,"line-width":1}},{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","$type","Polygon"],["==","active","false"]],paint:{"fill-color":b,"fill-outline-color":b,"fill-opacity":f}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","$type","Polygon"],["==","active","false"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":b,"line-width":1}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","$type","LineString"],["==","active","false"]],paint:{"line-color":b,"line-width":2}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","false"]],paint:{"circle-radius":4,"circle-color":b}},{id:"gl-draw-point-comment",type:"circle",filter:["all",["==","active","false"],["==","meta","feature"],["==","user_type","comment"]],paint:{"circle-radius":4,"circle-color":b,"circle-stroke-color":"#fff","circle-stroke-width":2}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":6,"circle-color":b,"circle-stroke-color":b,"circle-stroke-width":2}},{id:"gl-draw-point-comment-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["==","meta","feature"],["==","user_type","comment"]],paint:{"circle-radius":6,"circle-color":b,"circle-stroke-color":"#fff","circle-stroke-width":3}}]};return c.on("load",()=>{o.current=c,n(!0),P(null),c.addControl(new J.FullscreenControl,"top-right"),c.addControl(new J.NavigationControl({visualizePitch:!0}),"top-right");const W=new J.ScaleControl({unit:"metric",maxWidth:100});c.addControl(W,"bottom-left"),setTimeout(()=>{const f=c.getContainer().querySelector(".mapboxgl-ctrl-scale");f&&(f.style.display="block",f.style.visibility="visible",f.style.opacity="1")},1e3);const H=new Xt((f,v)=>{console.log(f,v,"<==== picked"),L=f||u,S=v||m,console.log(L,"<==== current"),ue(f),ne(v)});c.addControl(H,"top-right");const b=new ut({userProperties:!0,displayControlsDefault:!1,controls:{polygon:!0,line_string:!0,point:!0,trash:!0},styles:oe(L,S)});c.addControl(b,"top-right"),r.current=b,c.on("draw.create",async f=>{var q;const v=z.id;f.features.forEach(w=>{b.setFeatureProperty(w.id,"color",L)});const a=(q=f.features)==null?void 0:q[0];if(a){if(o.current.__activePopup&&o.current.__activePopup.remove(),a.geometry.type==="LineString"){if(!a||a.geometry.type!=="LineString")return;const V=`${be(a,{units:"meters"}).toFixed(2)} m`,Y=`polygon-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;a.properties.createdBy=t,a.properties.createdAt=new Date,a.createdAt=new Date().toISOString,a.properties.comment=V,a.properties.color=L,a.properties.id=Y;try{const C={featureType:"line",geometry:a.geometry,properties:a.properties,workDayId:v};(await R.post("/mapFeature",C,{headers:{Authorization:U}})).status===201&&X("Line created ",{variant:"success"}),b.add(a)}catch(C){console.error(C)}X(V,{variant:"success"})}if(a.geometry.type==="Polygon"){const w=Le.geometry(a.geometry).toFixed(2),V=`${w} m²`,Y=`polygon-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,C=Fe(a).geometry.coordinates;b.setFeatureProperty(a.id,"id",Y),a.properties.color=L,a.properties.createdAt=new Date,a.properties.createdBy=t,a.properties.areaM2=w,a.properties.id=Y,a.properties.opacity=S;try{const I={featureType:"polygon",geometry:a.geometry,properties:a.properties,workDayId:v};(await R.post("/mapFeature",I,{headers:{Authorization:U}})).status===201&&X("Polygon created ",{variant:"success"}),setTimeout(()=>{const ee=new J.Popup({closeButton:!0,offset:15}).setLngLat(C).setHTML(ce(de(a.properties,V))).addTo(o.current);o.current.__activePopup=ee,b.add(a)},0)}catch(I){console.error(I)}}if(a.geometry.type==="Point"){const w=c.getCanvas().getBoundingClientRect();ae({open:!0,feature:{feature:a,geometry:a.geometry,color:L,properties:{color:L}},isEdit:!1,position:{x:w.width/2,y:w.height/2}})}}}),c.on("draw.update",async f=>{var q,w,V,Y;o.current.__activePopup&&o.current.__activePopup.remove(),console.log("updating something");const v=z.id,a=(q=f.features)==null?void 0:q[0];if(a){if(f.features.forEach(C=>{b.setFeatureProperty(C.id,"color",L)}),((w=a==null?void 0:a.geometry)==null?void 0:w.type)==="Polygon"){const C=Le.geometry(a.geometry),I=(C/1e6).toFixed(2),Z=C.toFixed(2);Fe(a).geometry.coordinates,o.current.__activePopup=popup,a.properties.color=L,a.properties.areaKm2=I,a.properties.areaM2=Z,a.properties.opacity=S;try{const ee={featureType:"polygon",geometry:a.geometry,properties:a.properties,workDayId:v};(await R.patch(`/mapFeature/propertyId/${a==null?void 0:a.properties.id}`,ee,{headers:{Authorization:U}})).status===200&&X("Polygon Updated ",{variant:"success"})}catch(ee){console.error(ee)}}if(((V=a==null?void 0:a.geometry)==null?void 0:V.type)==="LineString")try{const C=be(a,{units:"kilometers"}),I=(C*1e3).toFixed(2),Z=je(a,C/2,{units:"kilometers"}).geometry.coordinates;a.properties.color=L,a.properties.lengthKm=C.toFixed(2),a.properties.lengthM=I;const ee={featureType:"line",geometry:a.geometry,properties:a.properties,workDayId:v};(await R.patch(`/mapFeature/propertyId/${a==null?void 0:a.properties.id}`,ee,{headers:{Authorization:U}})).status===200&&X("Line Updated",{variant:"success"})}catch(C){console.error("Error updating line:",C)}if(((Y=a==null?void 0:a.geometry)==null?void 0:Y.type)==="Point")try{const[C,I]=a.geometry.coordinates;a.properties.color=L,a.properties.coordinates=`${I.toFixed(6)}, ${C.toFixed(6)}`;const Z={featureType:"comment",geometry:a.geometry,properties:a.properties,workDayId:v};(await R.patch(`/mapFeature/propertyId/${a==null?void 0:a.properties.id}`,Z,{headers:{Authorization:U}})).status===200&&X("Point Updated",{variant:"success"})}catch(C){console.error("Error updating point:",C)}}}),c.on("draw.delete",async f=>{console.log("on delete"),o.current.__activePopup&&o.current.__activePopup.remove();const v=f.features[0];console.log("Deleted features:",f.features);try{(await R.delete(`/mapfeature/propertyId/${v.properties.id}`)).status===200&&X("Successfully removed feature",{variant:"success"})}catch(a){console.error("error removing feature",a)}}),c.on("click",f=>{var V,Y;console.log("on click"),o.current.__activePopup&&o.current.__activePopup.remove();const v=["gl-draw-line-inactive","gl-draw-line-inactive.hot","gl-draw-line-active","gl-draw-line-active.hot","gl-draw-line-static","gl-draw-point-inactive","gl-draw-point-inactive.hot","gl-draw-point-active","gl-draw-point-active.hot","gl-draw-point-static","gl-draw-polygon-fill-inactive","gl-draw-polygon-fill-inactive.cold","gl-draw-polygon-fill-inactive.hot","gl-draw-polygon-fill-active","gl-draw-polygon-fill-static","gl-draw-polygon-stroke-inactive","gl-draw-polygon-stroke-inactive.cold","gl-draw-polygon-stroke-active","gl-draw-polygon-stroke-static"],a=c.getStyle().layers.map(C=>C.id).filter(C=>v.includes(C)),q=c.queryRenderedFeatures(f.point,{layers:a});if(!q.length)return;const w=q[0];if(w.geometry.type==="Point"&&w.properties.user_type==="comment"){console.log(w,"<==== yeeter");const C=w.geometry.coordinates.slice(),I=((V=w.properties)==null?void 0:V.comment)||((Y=w.properties)==null?void 0:Y.user_comment)||"",Z=new J.Popup().setLngLat(C).setHTML(ce(de(w.properties,I))).addTo(c);o.current.__activePopup=Z}if(w.geometry.type==="Polygon"){console.log(w,"<=== featuer agae ");const I=`${Le.geometry(w.geometry).toFixed(2)} m²`,Z=Fe(w).geometry.coordinates;new J.Popup().setLngLat(Z).setHTML(ce(de(w.properties,I))).addTo(c)}if(w.geometry.type==="LineString"){console.log(w,"<==== feature line string selection");const C=be(w,{units:"kilometers"}),I=je(w,C/2,{units:"kilometers"}).geometry.coordinates,Z=C*1e3,ee=`${Z.toFixed(2)} m`;if(I&&!I.some(Number.isNaN)){const Pe=new J.Popup().setLngLat(I).setHTML(ce(de(w.properties,ee))).addTo(c);o.current.__activePopup=Pe}X(`Length: ${Z.toFixed(2)} m`,{variant:"success"})}}),c.on("draw.selectionchange",f=>{if(f.features.length>0){const v=f.features[0];if(console.log(v.geometry.type,"<=====randy"),v.geometry.type==="LineString"&&v.properties.mode!=="draw_polygon"){console.log(v,"<==== feature line string selection");const a=be(v,{units:"kilometers"}),q=je(v,a/2,{units:"kilometers"}).geometry.coordinates,w=a*1e3,V=`${w.toFixed(2)} m`;if(q&&!q.some(Number.isNaN)){const Y=new J.Popup().setLngLat(q).setHTML(ce(de(v.properties,V))).addTo(c);o.current.__activePopup=Y}X(`Length: ${w.toFixed(2)} m`,{variant:"success"})}if(v.geometry.type==="Point"){console.log(v,"<============wew");const a=new J.Popup().setLngLat(v.geometry.coordinates).setHTML(ce(de(v.properties,v.properties.comment))).addTo(c);o.current.__activePopup=a}}})}),c.on("sourcedata",W=>{var H;(H=W.sourceId)!=null&&H.includes("ortho-")&&W.isSourceLoaded&&(console.log("on source data remove"),$(!1))}),()=>{c&&c.remove&&c.remove(),o.current=null,n(!1)}},[z]),k.useEffect(()=>{if(!p||!o.current||!s||!F.length)return;(async()=>{var L;const u=F.find(S=>S.name===p);if(!u)return;fe(u.id);const m=r.current;m.deleteAll();try{const{data:S}=await R.get("/mapFeature",{params:{workDayId:u.id,limit:100},headers:{Authorization:U}}),W={type:"FeatureCollection",features:(((L=S==null?void 0:S.data)==null?void 0:L.results)||[]).map(({geometry:b,properties:f,createdBy:v,createdAt:a})=>b?{type:"Feature",geometry:b,properties:{...f,createdBy:v,createdAt:a,comment:(f==null?void 0:f.comment)||"",color:(f==null?void 0:f.color)||DEFAULT_COLOR,message:(f==null?void 0:f.message)||"No message set"}}:null).filter(Boolean)},H={...W,features:W.features.filter(b=>!!(b.geometry.type==="Point"&&l.showComments||b.geometry.type==="LineString"&&l.showLineString||b.geometry.type==="Polygon"&&l.showPolygons))};H.features.length&&(m.add(H),m.changeMode("simple_select")),l.orthomosaic&&u.tileBaseUrl&&($(!0),Me(u)),u.tileBounds&&Qe(u.tileBounds)}catch(S){console.error("Error loading map features:",S)}})()},[p,s,l,F]);const fe=c=>{const u=o.current;if(!u)return;[`ortho-${c}`,"all-features-points","all-features-lines","all-features-polygons","all-features-polygons-outline","comment-labels"].forEach(S=>{u.getLayer(S)&&(console.log("Removing layer:",S),u.removeLayer(S))}),[`ortho-${c}`,"all-features"].forEach(S=>{u.getSource(S)&&(console.log("Removing source:",S),u.removeSource(S))})},Me=c=>{const u=o.current;if(!u||!c.tileBaseUrl)return;const m=`ortho-${c.id}`;try{u.getLayer(m)&&u.removeLayer(m),u.getSource(m)&&u.removeSource(m),u.addSource(m,{type:"raster",tiles:[`${c.tileBaseUrl}/{z}/{x}/{y}.png`],tileSize:256,minzoom:18,maxzoom:24});const L=u.getStyle().layers.find(S=>S.id.startsWith("gl-draw-")).id;u.addLayer({id:m,type:"raster",source:m,paint:{"raster-opacity":l.orthomosaic?1:0,"raster-brightness-min":0,"raster-brightness-max":1}},L),console.log("Raster layer added:",m,"URL:",c.tileBaseUrl),setTimeout(()=>{const S=u.getLayer(m),oe=u.getSource(m);console.log("Layer check:",{layerExists:!!S,sourceExists:!!oe,layerVisible:u.getLayoutProperty(m,"visibility")!=="none",paintOpacity:u.getPaintProperty(m,"raster-opacity")})},1e3),$(!1)}catch(L){console.error("Error adding tile layer:",L),P("Failed to load orthomosaic tiles."),$(!1)}},Qe=c=>{const u=o.current;if(!u)return;const{north:m,south:L,east:S,west:oe}=c;u.fitBounds([[oe,L],[S,m]],{padding:50,maxZoom:18})},ve=c=>{d(u=>({...u,[c.target.name]:c.target.checked}))},et=c=>{g(c.target.value);const u=F.find(m=>m.name===c.target.value);E(u)},tt=c=>{const u=o.current;if(!(!u||!s)){if(console.log("Updating comment layer with features:",c),u.getLayer("comment-points")&&(console.log("Removing existing comment layer"),u.removeLayer("comment-points")),u.getSource("comments")&&(console.log("Removing existing comment source"),u.removeSource("comments")),console.log("checking features ",c),c&&c.length>0&&l.showComments){console.log("Adding new comment layer with",c.length,"features"),u.addSource("comments",{type:"geojson",data:{type:"FeatureCollection",features:c}}),u.addLayer({id:"comment-points",type:"symbol",source:"comments",layout:{"icon-image":"marker-15","icon-size":1.5,"text-field":["get","comment"],"text-offset":[0,1.5],"text-anchor":"top"},paint:{"text-size":.5,"text-color":"#000","text-halo-color":"#fff","text-halo-width":2}});const m=u.getLayer("comment-points");m&&console.log("Comment layer added successfully with ID:",m.id)}else console.log("No features to display, comment layer removed");u.isStyleLoaded()&&u.triggerRepaint(),console.log("Comment layer update complete")}},ot=async c=>{console.log("=== COMMENT DELETION DEBUG ==="),console.log("Attempting to delete comment",c),console.log("Current commentFeatures:",O),console.log(O[0].properties.comment),console.log(c.properties.comment);const u=O.filter(m=>m.properties.id!==c.properties.id);try{await R.delete(`/mapFeature/propertyId/${c.properties.id}`,{headers:{Authorization:U}})}catch(m){console.error(m)}console.log("Updated commentFeatures after deletion:",u),X("Successfully Removed Comment",{variant:"success"}),N(u),refreshCommentLayer(),ae({open:!1,feature:null,isEdit:!1,position:{x:0,y:0}}),console.log("=== END DELETION DEBUG ===")};return T?i.jsxs(ze,{children:[i.jsxs(K,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[i.jsx(se,{variant:"h1",gutterBottom:!0,children:"Exterior (Map View)"}),i.jsx(pe,{variant:"contained",onClick:()=>x(!0),disabled:M,children:"Upload New"})]}),i.jsx(Jt,{open:h,onClose:()=>x(!1)}),i.jsx(lt,{links:Qt,card:!0,custom:!0,rightAlign:!1}),i.jsx(pt,{sx:{my:2}}),i.jsxs(K,{display:"flex",height:"calc(100vh - 320px)",gap:1,children:[i.jsxs(K,{sx:{width:"250px",pr:2,height:"100%"},children:[i.jsx(se,{onClick:()=>{console.log(t,"<============ user");const c=o.current.querySourceFeatures("mapbox-gl-draw-cold"),u=o.current.querySourceFeatures("mapbox-gl-draw-hot");console.log("Cold:",c.map(m=>m.properties)),console.log("Hot:",u.map(m=>m.properties))},variant:"h3",gutterBottom:!0,children:"Layers"}),i.jsxs($t,{children:[i.jsx(xe,{control:i.jsx(we,{checked:l.orthomosaic,onChange:ve,name:"orthomosaic",disabled:M}),label:"Orthomosaic"}),i.jsx(xe,{control:i.jsx(we,{checked:l.showLineString,onChange:ve,name:"showLineString",disabled:M}),label:"Lines"}),i.jsx(xe,{control:i.jsx(we,{checked:l.showPolygons,onChange:ve,name:"showPolygons",disabled:M}),label:"Polygons"}),i.jsx(xe,{control:i.jsx(we,{checked:l.showComments,onChange:ve,name:"showComments",disabled:M}),label:"Comments"})]}),i.jsxs(wt,{fullWidth:!0,sx:{mt:3},children:[i.jsx(mt,{children:"Historical Data"}),i.jsx(bt,{value:p||"",onChange:et,label:"Historical Data",disabled:M||j.length===0,children:j.map(c=>i.jsx(Ct,{value:c,children:gt(c).format("DD-MM-YYYY")},c))})]}),M&&i.jsx(K,{sx:{display:"flex",justifyContent:"center",mt:2},children:i.jsx(Ye,{size:24})}),!M&&j.length===0&&i.jsx(Re,{severity:"info",sx:{mt:2},children:"No historical data available for this project."})]}),i.jsx(K,{ref:e,sx:{flex:1,borderRadius:2,overflow:"hidden",height:"100%",position:"relative",border:"1px solid #e0e0e0","& .mapboxgl-ctrl-scale":{border:"2px solid #333",borderTop:"none",color:"#333",backgroundColor:"rgba(255, 255, 255, 0.8)",padding:"2px 6px",fontSize:"12px",fontWeight:"bold"}}}),i.jsx(Kt,{addCommentLayer:tt,setCommentFeatures:N,commentInput:te,setCommentInput:ae,commentFeatures:O,handleDeleteComment:ot,workDay:z,drawRef:r.current})]})]}):i.jsx(ze,{children:i.jsx(Re,{severity:"warning",children:"No project selected. Please select a project first."})})}export{yo as default};
