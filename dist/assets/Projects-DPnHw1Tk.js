import{E as Z,j as e,a as V,c as _,r,U as $,B as x,T as i,V as q,S as P,i as U,W as X,M as u,X as J,n as K,d as Q,G as o,Y as ee,F as te,I as se,y as ne,l as b,Z as ae,_ as re,$ as oe,a0 as ie,a1 as le,a2 as ce,a3 as de,m as N,a4 as z}from"./index-D8LqObyy.js";import{P as he}from"./Person-D3XC2EmU.js";import{C as ue,M as xe}from"./MoreVert-4y3HbjoT.js";const me=Z(e.jsx("path",{d:"M22 16V4c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2m-11-4 2.03 2.71L16 11l4 5H8zM2 6v14c0 1.1.9 2 2 2h14v-2H4V6z"})),ge="/assets/conture-map-DVTY2EDp.jpg",je=({project:t,count:w,onDelete:c})=>{const d=V(),D=_(),[l,m]=r.useState(null),v=!!l,I=n=>{n.stopPropagation(),m(n.currentTarget)},k=n=>{n.stopPropagation(),m(null)},C=n=>{n.stopPropagation(),m(null),c&&c(t)},g=()=>{const n=t._id||t.id;D(J({id:n,name:t.name})),d(`/project/${n}/View`)};return e.jsxs($,{elevation:4,sx:{maxHeight:220,position:"relative",width:320,borderRadius:3,overflow:"hidden",cursor:"pointer",transition:"0.3s","&:hover":{boxShadow:6}},onClick:g,children:[e.jsxs(x,{sx:{position:"relative",height:140},children:[e.jsx(ue,{component:"img",height:"140",image:ge,alt:t==null?void 0:t.name,sx:{objectFit:"cover",filter:"brightness(60%)"}}),e.jsx(x,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",px:2},children:e.jsx(i,{variant:"subtitle1",fontWeight:700,color:"white",noWrap:!0,children:t==null?void 0:t.name})})]}),e.jsx(q,{sx:{pt:1,pb:1},children:e.jsxs(P,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(P,{direction:"row",spacing:1.5,alignItems:"center",flexWrap:"nowrap",children:[e.jsxs(P,{direction:"row",spacing:.5,alignItems:"center",sx:{minWidth:0},children:[e.jsx(me,{fontSize:"small"}),e.jsx(i,{variant:"caption",sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:140},children:t==null?void 0:t.location})]}),e.jsxs(P,{direction:"row",spacing:.5,alignItems:"center",children:[e.jsx(he,{fontSize:"small"}),e.jsx(i,{variant:"caption",children:w})]}),e.jsx(i,{variant:"caption",fontSize:10,color:"text.secondary",children:t!=null&&t.createdAt?new Date(t.createdAt).toLocaleDateString("en-GB").replace(/\//g,"-"):"Date unknown"})]}),e.jsxs(x,{children:[e.jsx(U,{size:"small",onClick:I,sx:{color:"text.secondary","&:hover":{backgroundColor:"rgba(0,0,0,0.05)"}},children:e.jsx(xe,{fontSize:"small"})}),e.jsxs(X,{anchorEl:l,open:v,onClose:k,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[e.jsx(u,{onClick:C,children:"Delete"}),e.jsx(u,{onClick:n=>{n.stopPropagation(),g()},children:"View"})]})]})]})})]})};function Se(){const t=K(),w=V(),c=Q(s=>s.auth),[d,D]=r.useState(""),[l,m]=r.useState("project.createdAt:desc"),[v,I]=r.useState([]),[k,C]=r.useState(!1),[g,n]=r.useState(null),[S,T]=r.useState(1),[W,F]=r.useState(1),O=12,[L,y]=r.useState(!1),[j,B]=r.useState(null),[p,M]=r.useState(!1),A=async(s="",a="",R=1)=>{var E;C(!0),n(null);try{const f={email:c.user.email,status:"active",page:R,limit:O};s&&(f.projectName=s),a&&(f.sortBy=a);const h=(E=(await N.get("/project-members",{params:f,headers:{Authorization:c.token}})).data)==null?void 0:E.data;I((h==null?void 0:h.results)||[]),F((h==null?void 0:h.totalPages)||1)}catch(f){n(f.message||"Failed to fetch projects")}finally{C(!1)}};r.useEffect(()=>{A(d,l,S)},[S]);const H=()=>{T(1),A(d,l,1)},Y=async()=>{var s;if(j){M(!0);try{(await N.delete(`/project/${j._id}`,{headers:{Authorization:c.token}})).status===200&&(z("Project deleted successfully",{variant:"success"}),A(d,l,S))}catch(a){console.log("Error deleting project:",a),((s=a==null?void 0:a.response)==null?void 0:s.status)===403?z("You do not have permission to delete this project",{variant:"error"}):z("Error deleting project",{variant:"error"})}finally{M(!1),y(!1),B(null)}}},G=s=>{B(s),y(!0)};return e.jsxs(x,{p:3,children:[e.jsxs(o,{container:!0,spacing:2,alignItems:"center",justifyContent:"space-between",mb:3,children:[e.jsx(o,{item:!0,xs:12,md:3,children:e.jsx(i,{variant:"h2",fontWeight:600,children:"All Projects"})}),e.jsx(o,{item:!0,xs:12,md:6,children:e.jsxs(o,{container:!0,justifyContent:"center",alignItems:"center",spacing:2,children:[e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsx(ee,{label:"Search by Name",variant:"outlined",size:"small",fullWidth:!0,value:d,onChange:s=>D(s.target.value)})}),e.jsx(o,{item:!0,xs:12,sm:6,children:e.jsxs(te,{sx:{...t.typography.customSelect2,minWidth:"100px"},fullWidth:!0,children:[e.jsx(se,{children:"Sort By"}),e.jsxs(ne,{size:"small",value:l,label:"Sort By",onChange:s=>m(s.target.value),children:[e.jsx(u,{value:"project.name:asc",children:"Project Name (A → Z)"}),e.jsx(u,{value:"project.name:desc",children:"Project Name (Z → A)"}),e.jsx(u,{value:"project.createdAt:desc",children:"Project Date (Newest)"}),e.jsx(u,{value:"project.createdAt:asc",children:"Project Date (Oldest)"})]})]})}),e.jsx(o,{item:!0,xs:12,sm:2,children:e.jsx(b,{variant:"contained",fullWidth:!0,onClick:H,children:"Search"})})]})}),e.jsx(o,{item:!0,xs:12,md:3,textAlign:{xs:"left",md:"right"},children:e.jsx(b,{variant:"contained",onClick:()=>w("/createProject"),startIcon:e.jsx(ae,{}),color:"primary",children:"Create New Project"})})]}),k?e.jsx(i,{variant:"body1",children:"Loading projects..."}):g?e.jsx(i,{color:"error",children:g}):v.length===0?e.jsx(x,{mt:6,textAlign:"center",children:e.jsx(i,{variant:"h6",color:"text.secondary",children:"No projects found. Create a project to start working."})}):e.jsxs(e.Fragment,{children:[e.jsx(o,{container:!0,spacing:3,children:v.map((s,a)=>e.jsx(o,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsx(je,{project:s.project,count:s.memberCount,onDelete:G})},a))}),W>1&&e.jsx(x,{mt:4,display:"flex",justifyContent:"center",children:e.jsx(re,{count:W,page:S,onChange:(s,a)=>T(a),color:"primary"})})]}),e.jsxs(oe,{open:L,onClose:()=>!p&&y(!1),fullWidth:!0,maxWidth:"xs",children:[e.jsx(ie,{children:"Delete Project"}),e.jsx(le,{children:e.jsxs(i,{children:["You are about to delete ",e.jsx("strong",{children:j==null?void 0:j.name}),". This action cannot be undone."]})}),e.jsxs(ce,{children:[e.jsx(b,{onClick:()=>y(!1),disabled:p,children:"Cancel"}),e.jsx(b,{color:"error",variant:"contained",onClick:Y,disabled:p,startIcon:p?e.jsx(de,{size:18}):null,children:p?"Deleting...":"Delete"})]})]})]})}export{Se as default};
