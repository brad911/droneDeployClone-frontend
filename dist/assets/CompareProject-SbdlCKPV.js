import{aq as I,r as a,d as R,j as s,M as T,B as d,T as E,aA as P,aB as W,aD as G,h as z}from"./index-CN-_sALa.js";import{s as F}from"./index-DoUOZHJR.js";import{m as M}from"./mapbox-gl-CihBitUN.js";import{I as J}from"./IconBuildingCog-ELyNmUZ2.js";import{F as j}from"./OutlinedInput-4cDgOf4F.js";import{S as g}from"./Select-C8ECBflM.js";import{M as y}from"./MenuItem-oDMYrQJ6.js";var x,v;function Z(){if(v)return x;v=1;function o(e,t){t.jumpTo({center:e.getCenter(),zoom:e.getZoom(),bearing:e.getBearing(),pitch:e.getPitch()})}function i(e,t){r();function r(){e.on("move",c),t.on("move",m)}function u(){e.off("move",c),t.off("move",m)}function c(){u(),o(e,t),r()}function m(){u(),o(t,e),r()}}return x=i,x}var A=Z();const L=I(A);M.accessToken="pk.eyJ1IjoiaGlyYWtyYWoiLCJhIjoiY21icXd5eHRnMDNtaTJxczcxd2RmbTZwOCJ9.P6kpsuLMDdeK2DIMJZMrmw";const b=({workDay:o,onMapReady:i})=>{const e=a.useRef(null);return a.useEffect(()=>{if(!e.current||!(o!=null&&o.tileBaseUrl))return;const t=new M.Map({container:e.current,style:"mapbox://styles/mapbox/satellite-v9",center:[(o.tileBounds.west+o.tileBounds.east)/2,(o.tileBounds.south+o.tileBounds.north)/2],zoom:o.tileZoomMin??15});return t.on("load",()=>{t.addSource("ortho-source",{type:"raster",tiles:[`${o.tileBaseUrl}/{z}/{x}/{y}.png`],tileSize:256}),t.addLayer({id:"ortho-layer",type:"raster",source:"ortho-source"}),t.scrollZoom.enable(),t.dragPan.enable(),t.dragRotate.enable(),t.keyboard.enable(),i&&i(t)}),()=>t.remove()},[o,i]),s.jsx(d,{ref:e,sx:{width:"100%",height:"100%"}})};function w(){const[o,i]=a.useState([]),[e,t]=a.useState(null),[r,u]=a.useState(null),[c,m]=a.useState(null),[p,B]=a.useState(null),h=R(n=>n.project.id);a.useEffect(()=>{(async()=>{try{const f=(await z.get(`/work-day?projectId=${h}&limit=1000`)).data.data.results.filter(S=>S.tileBaseUrl);i(f),f.length>=2&&(t(f[0]),u(f[1]))}catch(l){console.error("Failed to fetch workdays",l)}})()},[h]),a.useEffect(()=>{if(c&&p){const n=L(c,p);return()=>n&&n()}},[c,p]);const C=[{title:"Projects",to:"/project",icon:W},{title:"Project Name",to:`/project/${h}/View`,icon:J},{title:"Compare View",icon:G}];return s.jsxs(T,{children:[s.jsx(d,{sx:{justifyContent:"space-between",alignItems:"center"},children:s.jsx(E,{variant:"h1",gutterBottom:!0,children:"Compare View"})}),s.jsx(d,{justifyContent:"left",children:s.jsx(P,{links:C,card:!0,custom:!0,rightAlign:!1})}),s.jsxs(d,{display:"flex",gap:2,mb:3,children:[s.jsx(j,{fullWidth:!0,children:s.jsx(g,{value:(e==null?void 0:e.id)||"",onChange:n=>t(o.find(l=>l.id===n.target.value)),children:o.map(n=>s.jsx(y,{value:n.id,children:n.name},n.id))})}),s.jsx(j,{fullWidth:!0,children:s.jsx(g,{value:(r==null?void 0:r.id)||"",onChange:n=>u(o.find(l=>l.id===n.target.value)),children:o.map(n=>s.jsx(y,{value:n.id,children:n.name},n.id))})})]}),s.jsx(d,{mb:5,borderRadius:2,overflow:"hidden",sx:{height:500},children:e&&r&&s.jsx(F,{onlyHandleDraggable:!0,itemOne:s.jsx(b,{workDay:e,onMapReady:m}),itemTwo:s.jsx(b,{workDay:r,onMapReady:B}),style:{height:"100%"}})})]})}export{w as default};
